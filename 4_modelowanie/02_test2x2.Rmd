---
title: "Testy 2x2"
author: "pogRomcy danych"
date: "sezon 3 / odcinek 2<br><br> Wszelkie prawa zastrzeżone.<br> Wykorzystanie możliwe wyłącznie za zgodą autora.  <br><br><br><br>Naciśnij `A` by zamienić slajdy na ciągły tekst. <br> Naciśnij `T` by wyświetlić spis treści."
output:
  slidy_presentation:
    includes:
      in_header: ../tracking.html
    highlight: default
    css: ../style.css
    font_adjustment: 0
    footer: "pogRomcy danych / pierwsze kroki / testy 2x2"
---

# O czym jest ten odcinek

Jak badać czy dwie zmienne są zależne?

Co oznacza zależność?

W tym odcinku rozważymy najprostszą zależność dla pary zmiennych - zależność pomiędzy parą zmiennych binarnych.

W tym odcinku nauczymy się jak:

- jak budować i jak czytac tablice kontyngencji dla pary zmiennych
- jak przedstawiać graficznie tabelę kontyngencji
- jak statystycznie testować zależność pomiedzy parą zmiennych.

Do ilustracji tych zagadnień wykorzystamy dwa zbiory danych. Pierwszy, to dane z Diagnozy Społecznej, dostępne w tabeli `diagnoza` a drugi o nowotworze piersi, dostępne w tabeli `TCGA_BRCA`, oba dostępne w pakiecie `PogromcyDanych`.

---

# Jak opisać zależnośc dwóch zmiennych binarnych

Zmienne binarne, to zmienne, które przyjmją po dwie wartości. 

Zmienne takie są bardo proste w opisie, wystarczy napisać ile razy wystąpiła pierwsza wartość ile razy druga i w ten sposób dwie liczby charakteryzują wszystkie obserwacje.

Typową zmienną binarną jest płeć ze swoimi dwoma poziomami/wartościami. Zmiennymi binarnymi sa też zmienne logiczne przyjmujące wartości TRUE/FALSE. W obu tych przykładach w danych dopuszcza się też wartość *brak danych* (NA) ale najczęściej nawet zmienne z brakami danych, de facto przyjmujące trzy różne wartości nazywa się binarnymi.
 
Zmienne jakościowe przyjmujące więcej poziomó∑ lub zmienne ciągłe można binaryzować i często wykonuje się tę operację.

Jeżeli mamy zmienną opisującą kolor włosów i większość osób to bruneci/brunetki, wtedy wygodnie może być zamienić zmienną jakościwą na binarną odpowiadającą na ptyanie : czy to brunet (a więc po połączeniu wszystkich pozostałych  poziomów).
 
Jeżeli mamy zmienną ciągłą - wzrost, możemy ją zbinaryzować dzieląc wzrost na dwa przedziały, np do 170 cm i powyżej.

W tym miejscu powinno pojawić się pytanie *po co*? Po co redukować więcej informacji do dwóch poziomów? 

Główną zaletą jest łatwość opisu. Jedną zmienną binarną opisać można za pomocą dwóch liczb.

Relację pomiędzy dwoma zmiennymi binarnymi opisać można za pomocą czterech liczb za pomocą tak zwanej tablicy kontyngencji.

.              |  Zmienna 1: A| Zmienna 1: B
---------------|--------------|--------------
Zmienna 2: X   |    $n_{1,1}$ |    $n_{2,1}$ 
Zmienna 2: Y   |    $n_{1,2}$ |    $n_{2,2}$ 

Zależność pomiędzy dwomz zmiennymi binarnymi opisują cztery liczby, $n_{1,1}$ opisuje liczbę przypadków w których zmienna 1 przyjmuje wartość A a zmienna 2 wartość X, $n_{1,2}$ opisuje liczbę przypadków w których zmienna 1 przyjmuje wartość A a zmienna 2 wartość Y, i tak dalej.


# Wczytanie danych

Dane od których rozpoczniemy przykłady to `diagnoza` z pakietu `PogromcyDanych`. Aby te dane wczytać, wystarczy włączyć ten pakiet - instrukcja jak to zrobić znajduje się w odcinku 2 pierwszego sezonu.

W zbiorze danych `diagnoza` dostępnych jest kilkadziesiąt kolumn, opisujących odpowiedzi na różne interesujące pytania. W tym odcinku przyjrzymy się tylko kilku  wybranym kolumnom, opisującym imię, wiek, płeć, ukończoną edukację oraz odpowiedź na pytanie ,,Co jest wedlug Pana wazniejsze w zyciu?'' (zmienna w kolumnie `gp29`) z możliwymi odpowiedziami *Poczucie sensu* i *Przyjemności*.

```{r, warning=FALSE, message=FALSE}
library(PogromcyDanych)
diagnoza[1:6, c("imie_2011", "wiek2013", "plec", "eduk4_2013", "gp29")]
```

# Jak wygląda tabela kontyngencji

W zbiorze danych `diagnoza` mamy dwie binarne zmienne, `plec`, czyli płeć respondenta i `gp29`, czyli odpowiedź na pytanie co jest ważniejsze w życiu.
 
Zobaczmy jak wygląda tablica kontyngencji, zestawiajaca te dwie zmienne.
 
```{r}
table(diagnoza$plec, diagnoza$gp29)
```

Przyjrzyjmy się tym wynikom

- 5114 mężczyzn odpowiedziało, że wazniejsze są przyjemności,
- 6544 mężczyzn odpowiedziało, że wazniejsze jest poczucie sensu,
- 5144 kobiet odpowiedziało, że wazniejsze są przyjemności,
- 9421 kobiet odpowiedziało, że wazniejsze jest poczucie sensu.

Zarówno kobiety jak i mężczyźni częściej deklarują, że ważniejsze jest poczucie sensu. 
Ale czy sa róznice pomiędzy tymi płciami i jak duże?

# Jak wygląda tabela z procentami

Przeliczmy liczebności na frakcje. Jaki procent mężczyzn odpowiedziało przyjemności a jaka poczucie sensu?

Funkcją `prop.table()` można policzyć frakcje, dodatkowy argument określa czy mają być to proporcje w wierszach (1), kolumanch (2) czy całej macierzy (pusty argument).

```{r}
plecSens <- table(diagnoza$plec, diagnoza$gp29)
# frakcje w wierszach
prop.table(plecSens, 1)
# frakcje w całej tabeli
prop.table(plecSens)
```

# Jak wyglądają szanse

Pracując ze zmiennymi binarnymi często zamiast prawdopodobieństw korzysta się z tak zwanych szans (ang. odds). 

Co to jest szansa?

Szasna wystąpienia zjawiska X to prawdopodobieństwo wystąpienia X podzielone przez prawdopodobieństwo nie wystąpienia X. Czyli jeżeli prawdopodobieństwo oznaczymy symbolem $p$ to otrzymamy 

$$
odds = \frac{p}{1-p}
$$

W przeciwieństwie do prawdopodobieństwa, szansa może przyjmowac wartości większe od 1. 

Policzmy szanse, że kobieta lub mężczyzna odpowie *Przyjemności* na pytanie o to co ważniejsze.

```{r}
frakcje <- prop.table(plecSens, 1)
frakcje[,1]/frakcje[,2]
```

# Jak wyglądają ilorazy szans

Jaka jest zaleta w używaniu szans nad prawdopodobieństwem?

Główną zaletą jest możliwość operania na ilorazach szans. 
Iloraz szans przedstawia ile razy szansa w jednej grupie jest większa od szansy w dużej grupie.

$$
oddsRatio_{A/B} = odds_{A}/odds_{B} = \frac{p_A (1-p_B)}{(1-p_A)p_B}
$$

Przedstawmy iloraz szan na przykładzie płci i odpowiedzi na pytanie o wartości. 

Policzymy ilu krotnie szansa na odpowiedź *Przyjemności* jest większa u męzczyzn niż u kobiet.

Jeżeli iloraz szans wynosi 1 to znaczy że szanse są równe w obu grupach przez co te dwie zmienne nie są zależne.

Jeżeli szansa jest mneijsza lub większa niż jeden, wtedy pojawia się zależność.

W przykładzie dla Diagnozy Społecznej, iloraz szans wynosi `1.4312`, co oznacza, że szansa, że dla losowo wylosowanego mężczyzny, szansa że odpowie *Przyjemności* jest o 43% większa niż u kobiety.

```{r}
frakcje <- prop.table(plecSens, 1)
szanse <- frakcje[,1]/frakcje[,2]
szanse[1] / szanse[2]
```

# Wykres mozaikowy


```{r}
mosaicplot(plecSens)
```



---

# O czym jest ten odcinek

```{r, eval=FALSE}
table(plecCoWazne$plec, plecCoWazne$gp29)

prop.table(table(plecCoWazne$plec, plecCoWazne$gp29), 1)

fisher.test(table(plecCoWazne$plec, plecCoWazne$gp29))


prop.table(table(diagnoza$gp54_11, cut(diagnoza$wiek2013, c(0, 25, 40, 60, 110))), 2)

addmargins(table(ojcowiedziecmi = diagnoza$gp54_22, dziecirodzicami = diagnoza$gp54_11))

```

# tez 2xp

```{r}

prop.table(table(diagnoza$gp29, cut(diagnoza$wiek2013, c(0, 25, 40, 60, 110))), 2)

prop.table(table(diagnoza$gp29, diagnoza$eduk4_2013), 2)

prop.table(table(diagnoza$eduk4_2013, cut(diagnoza$wiek2013, c(0, 25, 40, 60, 110)), diagnoza$gp29), 1:2)

```

---

Test 2x2 McNemara


```{r, eval=FALSE}
# brak przerzutow dobrze rokuje
table(TCGA_BRCA$new.tumor,
      TCGA_BRCA$vital.status)

fisher.test(table(TCGA_BRCA$new.tumor,
      TCGA_BRCA$vital.status))

fisher.test(table(TCGA_BRCA$new.tumor,
      TCGA_BRCA$TP53 == "Wild type"))


head(TCGA_BRCA)

table(TCGA_BRCA$TP53,
      TCGA_BRCA$vital.status)

chisq.test(table(TCGA_BRCA$TP53,
      TCGA_BRCA$vital.status))

pairwise.prop.test(TCGA_BRCA$new.tumor, TCGA_BRCA$TP53)

```


