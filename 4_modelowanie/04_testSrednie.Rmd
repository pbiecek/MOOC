---
title: "Testy równości średnich"
author: "pogRomcy danych"
date: "sezon 2 / odcinek 2<br><br> Wszelkie prawa zastrzeżone.<br> Wykorzystanie możliwe wyłącznie za zgodą autora.  <br><br><br><br>Naciśnij `A` by zamienić slajdy na ciągły tekst. <br> Naciśnij `T` by wyświetlić spis treści."
output:
  slidy_presentation:
    includes:
      in_header: ../tracking.html
    highlight: default
    css: ../style.css
    font_adjustment: 0
    footer: "pogRomcy danych / modelowanie / testy średnich"
---

# O czym jest ten odcinek

Analizując dane, często trafiamy na sytuację, gdy mamy do porównania dwie grupy pomiarów i jesteśmy ciekawi, czy te grupy różnią się między sobą.

Analizując dane medyczne możemy mieć pacjentów biorących lek A i lek B i chcemy sprawdzić czy skuteczność obu leków jest porównywalna czy też jedne z nich jest częściej lepszy. Analizując uprawę zbóż możemy mieć dwie odmiany i chcemy sprawdzić czy jedna daje wyższe plony niż druga. Takie przykłady można mnożyć.

Zazwyczaj gdy w jednej grupie policzymy średnią okreslonej cechy i w drugiej grupie policzymy średnią tej cechy to któraś z tych średnich jest większa. 

Jeżeli porównam średnie temperatury we Wrocławiu i średnie temperatury w Warszawie, to któraś z tych średnich będzie większa. Ale czy ta różnica wynika z losowych fluktuacji temperatury czy też jest odzwierciedleniem pewnej ogólnej prawidłowości, że w jednym z tych miast jest średnio cieplej?

I tutaj pojawia się statystyka. Używając takich narzędzi jak testy dla dwóch prób możemy pomóc sobie w odpowiedzi na pytanie, czy obserwowane różnice są czysto przypadkowe, czy też nie.

W tym odcinku, na przykładzie danych z serwisu IMDB (Internet Movie Database), pokażemy jak działa test Wilcoxona, uniwersalne narzędzie do porównywania dwóch grup.

---

# Czy serial Friends jest lepszy niż serial Braking Bed?

W bazie danych o filmach IMDB (Internet Movie Database) znaleźć można dane o serialach a w szczególności średnie oceny użytkowników wystawione kolejnym odcinkom serialu.

Przykładowo, na stronie http://www.imdb.com/title/tt0108778/epdate?ref_=ttep_ql_4 znajdują się oceny serialu *Friends* a na stronie http://www.imdb.com/title/tt0903747/epdate?ref_=ttep_ql_4  oceny serialu *Breaking Bad*.

Dane te zostały pobrane z Internetu i przygotowane tak, że teraz są dostępne w zbiorze danych `serialeIMDB` w pakiecie `PogromcyDanych`, który towarzyszy temu kursowi.

```{r, warning=FALSE, message=FALSE}
library(PogromcyDanych)
head(serialeIMDB)
```

---

# Czy serial Friends jest lepszy niż serial Braking Bed?

Mając taki zbiór danych, możemy porównać oceny odcinków dwóch seriali. Wyciągnijmy z tego zbioru danych oceny dla serialu *Friends* i oceny dla serialu *Breaking Bad*

```{r}
ocenyFriends     <- serialeIMDB[serialeIMDB$serial == "Friends", "ocena"]
summary(ocenyFriends)

ocenyBreakingBad <- serialeIMDB[serialeIMDB$serial == "Breaking Bad", "ocena"]
summary(ocenyBreakingBad)
```

Średnia w jednym serialu to `8.508` a w drugim `8.481`. Mediana w jednym to `8.5` a w drugim `8.4`.

Czy to duża różnica czy mała?

---

# Czy serial Friends jest lepszy niż serial Braking Bed?

Interesujące narzędzie do porównywania dwóch grup w roku 1945 zaproponował chemik i statystyk Frank Wilcoxon.

Pomysł na porównanie dwóch grup skłąda się z trzech kroków. Przedstawmy je jeden po drugim.

# Krok 1: Postaw hipotezę, określ co chcesz porównać

Będziemy testować hipotezę, czy wartości w jednym zbiorze są istotnie większe niż wartości w drugim zbiorze. 

Tę hipotezę, sformuujmy w następujący sposób: *Czy obserwowana różnica pomiędzy ocenami jest wystarczająco duża, by uznać ją za istotną?*

# Krok 2: Określ miarę wielkości różnic

Wilcoxon zaproponował, by dla pytania, które postawiliśmy w kroku 1 porównać każdą wartość z jednego zbioru z każdą wartością z drugiego zbioru a następnie policzyć:

* [A] ile było par, takich że wartość z pierwszego zbioru była większa od wartości z drugiego zbioru,
* [B] ile było par, takich że wartość z pierwszego zbioru była mniejsza od wartości z drugiego zbioru,
* [C] ile było par, takich że wartość z pierwszego zbioru była równa wartości z drugiego zbioru.

Następnie, jako miarę różnicy dwóch grup wybierzemy większą z liczb [A] i [B].

Jak to wygląda dla naszych seriali? 

Funkcja `outer(x, y, fun)` wykonuje funkcję `fun` dla każdej pary wartości z wektorów `x` i `y`. W poniższym przykładzie porównujemy jażdą parę a następnie sumujemy ile razy wystąpiła wartość `TRUE` w porównaniu.

```{r}
# ile par odcinków, takich że Friends są gorsze
sum(outer(ocenyFriends, ocenyBreakingBad, `<`))
# ile par odcinków, takich że Friends są lepsze
sum(outer(ocenyFriends, ocenyBreakingBad, `>`))
# ile par odcinków, takich że Friends są są równe
sum(outer(ocenyFriends, ocenyBreakingBad, `==`))
```

Tak więc porównując wszystkie pary wartości w `6260` przypadkach oceny odcinków z serialu *Friends* były gorsze a w `7700` były lepsze niż w serialu *Breaking Bad*.

Za naszą miarę różnicy wybierzemy większą z tych dwóch liczb, czyli `7700`.

# Krok 3: Porównaj zaobserwowaną wielkość różnicy z różnicą w sytuacji gdyby grupy nie były różne

Wciąż nie wiemy, czy to `7700` to duża róznica czy mała. Musimy ją z czymś porównać.

Frank Wilcoxon zaproponował, by porównać ją z wartościami, które byśmy obserwowali gdyby te dwie grupy się nie różniły. 

Ale skąd wiadomo jakie byłyby różnice gdyby obie grupy się nie różniły? Możemy to oszacować w następujący sposób

* [I] Wymieszajmy losowo wartości w obu grupach zachowując jedynie liczebność grupy. Dzięki temu otrzymamy dwie grupy o których wiemy, że się nie różnią istotnie a jedyne różnice wynikają z losowych fluktuacji w przypisaniach
* [II] Policzmy jak duża jest różnica dla tych nowo wylosowanych grup
* [III] Powtórzmy kroki [I] i [II] wielokrotnie aby zobaczyć jak duże wartości może przyjmować ta różnica w styuacji gdy obie grupy nie różnią się od siebie

```{r}
liczbaFriends <- length(ocenyFriends)
liczbaBreakingBad <- length(ocenyBreakingBad)

roznice <- replicate(10000, {
  wymieszane <- sample(c(ocenyFriends, ocenyBreakingBad))
  oceny1 <- wymieszane[1:liczbaFriends]
  oceny2 <- wymieszane[(liczbaFriends+1):(liczbaFriends+liczbaBreakingBad)]

  mniejszych <- sum(outer(oceny1, oceny2, `<`))
  wiekszych <- sum(outer(oceny1, oceny2, `>`))
  max(mniejszych, wiekszych)
})
```

```{r}
quantile(roznice, seq(0,1,0.1))
```

```{r}
mean(roznice > 7700)
```







---

# Czy serial Friends jest lepszy niż serial Braking Bed?


---

# Czy serial Friends jest lepszy niż serial Braking Bed?


<center><iframe width="770" height="700" frameborder="0" src="https://smarterpoland.shinyapps.io/serialeIMDB_dwieGrupy"></iframe></center>

---



