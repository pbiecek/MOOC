---
title: "Eksploracja danych"
author: "pogRomcy danych"
date: "sezon 2 / odcinek 12<br><br> <a href='http://biecek.pl/'>Przemysław Biecek @ Uniwersytet Warszawski</a><br><br>Naciśnij `A` by zamienić slajdy na ciągły tekst. <br> Naciśnij `T` by wyświetlić spis treści."
output:
  slidy_presentation:
    includes:
      in_header: ../tracking.html
    highlight: default
    css: ../style.css
    font_adjustment: 0
    footer: "pogRomcy danych / modelowanie / eksploracja"

---

```{r, echo=FALSE}
library(knitr)
opts_chunk$set( message=FALSE,tidy.opts=list(keep.blank.line=TRUE, width.cutoff=90),options(width=90))
```

# O czym jest ten odcinek?

Zanim zacznie się budować modele, zanim rozpocznie się zaawansowaną analizę danych, wcześniej zawsze warto przyjrzeć się bliżej danym.

Takie przyglądanie się danym, często bez konkretnego celu, nazywa się eksploracją. 

Pierwsze spojrzenie na dane. Sprawdzenie z jakimi zmiennymi, z jakimi zakresami zmiennych, jakimi relacjami pomiędzy zmiennymi mamy do czynienia.

Eksplorację często zaczyna się od przyjrzenia każdej ze zmiennych osobno, ewentualnie parami, bazując na prostych podsumowaniach graficznych lub tabelarycznych.

W tym odcinku pokażemy jak przedstawiać rozkład zmiennej ilościowej oraz zmiennej jakościowej, za pomocą kilku popularnych statystyk. 

Dla zmiennej ilościowej (liczbowej) przedstawimy

- średnią, medianę,
- pięć liczb Tukeya,
- wykres ramka wąsy, histogram.

Dla zmiennej jakościowej (z kategoriami) przedstawimy

- tablice kontyngencji,
- sortowanie.

---

# Baza danych o filmach i serialach

W bazie danych o filmach IMDB (Internet Movie Database) znaleźć można różne ciekawe dane o serialach. W szczególności średnie oceny użytkowników wystawione kolejnym odcinkom serialu.

Przykładowo, na stronie http://www.imdb.com/title/tt0903747/epdate?ref_=ttep_ql_4 znajdują się oceny serialu *Breaking Bad*.

Na potrzeby tego odcinka pobraliśmy dane z Internetu, oczyściliśmy je i udostępniliśmy w zbiorze danych `serialeIMDB` w pakiecie `PogromcyDanych`, który towarzyszy temu kursowi. 

Cały zbiór danych jest dosyć duży, wszystkich odcinków wszystkich seriali jest ponad 20 tysięcy wierszy, każdy opisany przez 8 kolumn/zmiennych. 

Wczytujemy zbiór danych, jeżeli nie jest zainstalowany to należy go zainstalować  poleceniem `install.packages("PogromcyDanych")`.

```{r, warning=FALSE, message=FALSE}
library(PogromcyDanych)
```
Sprawdzamy wielkość zbioru danych.
```{r, warning=FALSE, message=FALSE}
dim(serialeIMDB)
```
Wyświetlmy pierwsze 6 wierszy. W kolejnych kolumnach jest nazwa serialu, nazwa odcinka, numer sezonu, numer odcinka, średnia ocena, liczba oddanych głosów, oraz identyfikator z bazy IMDB.
```{r, warning=FALSE, message=FALSE}
head(serialeIMDB)
```

---

# Seriale

Każdy wiersz w zbiorze danych `serialeIMDB` opisuje oceny jednego odcinka dla każdego z przeszło 200 seriali.

Kolumna danych o nazwie `serial` jest zmienną jakościową, przyjmującą za wartości nazwy seriali. Listę poziomów zmiennej jakościowej można wyświetlić funkcją `levels()`.

Zapis `serialeIMDB$serial` oznacza odwołanie się do kolumny `serial` ze zbioru danych `serialeIMDB`.

Z jakimi serialami mamy do czynienia w tym zbiorze danych?

```{r, message=FALSE, warning=FALSE, fig.width=7, fig.height=5.5}
levels(serialeIMDB$serial)
```

---

# Tabela liczebności

Kolumna `serialeIMDB$serial` zawiera nazwy seriali. Te nazwy powtarzają się dla każdego serialu tyle razy, ile odcinków jest opisanych w zbiorze danych. Użyteczną funkcją do eksploracji zmiennych jakościowych jest tabela częstości. Przedstawia ona jak często określona wartość występuje w wektorze.

Tabelę częstości można wyznaczyć funkcją `table()`. Wynik tej funkcji można wyświetlić na ekranie lub, jak w poniższym przykładzie, zapisać do zmiennej.

```{r, message=FALSE, warning=FALSE, fig.width=7, fig.height=5.5}
tabela <- table(serialeIMDB$serial)
# pierwsze 6 wartości z wektora
head(tabela)
```

Tabelę liczebności dla 200 seriali trudno się przegląda. Jeżeli interesują nas najczęstsze lub najrzadsze wartości to aby je odczytać warto tabelę liczebności posortować (funkcja `sort()`). 

Po posortowaniu w sposób malejący (argument `decreasing = TRUE`) najczęstsze wartości znajdą się na początku a najrzadsze na końcu posortowanego wektora.

Ponad 500 odcinków dla Simpsonów? Robi wrażenie.

```{r, message=FALSE, warning=FALSE, fig.width=7, fig.height=5.5}
sort(tabela, decreasing = TRUE)
```

---

# Breaking Bad

Cały zbiór danych o serialach ma ponad 20 tysięcy wierszy.
Praca na tak dużym zbiorze danych, o wszystkich serialach jest z różnych powodów trudna. Między innymi dlatego, że nie jesteśmy w stanie ogarnąć wzrokiem wszystkich 20 tysięcy wierszy.

Na potrzeby dalszych przykładów wybierzmy z tego zbioru danych jeden serial, któremu przyjrzymy się bliżej. Na tych slajdach będzie to *Breaking Bad*, ale warto samodzielnie poeksperymentować również z innymi serialami.

Funkcją `filter()` wybieramy tylko wiersze dla serialu Breaking Bad.

```{r,  message=FALSE, warning=FALSE, fig.width=7, fig.height=5.5}
BreakingBad <- filter(serialeIMDB, serial == "Breaking Bad") 
```
O ilu odcinkach dostępna jest informacja dla tego serialu? 
```{r,  message=FALSE, warning=FALSE, fig.width=7, fig.height=5.5}
dim(BreakingBad)
```
A jak wyglądają dane dla serialu *Star Trek: The Next Generation*?
```{r,  message=FALSE, warning=FALSE, fig.width=7, fig.height=5.5}
filter(serialeIMDB, serial == "Star Trek: The Next Generation") 
```

# Co się dzieje z ocenami odcinków?

Co ciekawego możemy zrobić z danymi dla jednego serialu?

Z pewnością interesującą informacją są oceny danego serialu.
Ta informacja dostępna jest w kolumnie `ocena` i można się do niej dostać odwołując się do tej kolumny operatorem `$`.

Ale przecież każdy odcinek podobał się inaczej, jeden bardziej inny mniej. 
Porównajmy trzy sposoby przedstawienia informacji o ocenach.
Czy któryś z tych sposobów prezentacji liczb pozwala na zauważenie czegoś ciekawego?

Odcinki są uporządkowane zgodnie z datą emisji.

[HINT] Od odcinka 45 oceny odcinków się poprawiają. Na którym sposobie prezentacji widać to najwyraźniej? A na którym najmniej wyraźnie. Dlaczego?

1. Sposób pierwszy: wektor liczb

```{r, message=FALSE, warning=FALSE, fig.width=8, fig.height=6}
BreakingBad$ocena
```

# Co się dzieje z ocenami odcinków?

2. Sposób drugi: wykres słupkowy, wysokość słupka odpowiada ocenie.


```{r, message=FALSE, warning=FALSE, fig.width=8, fig.height=6}
barplot(BreakingBad$ocena)
```

# Co się dzieje z ocenami odcinków?

3. Sposób trzeci: wykres punktowy, pozycja punktu odpowiada ocenie odcinka.

```{r, message=FALSE, warning=FALSE, fig.width=8, fig.height=6}
plot(BreakingBad$ocena)
```

# Sortowanie

Często interesujące obserwacje to skrajne obserwacje. 

Ale jak najłatwiej się zorientować które odcinki uzyskują skrajne oceny?

Najłatwiej posortować odcinki po ocenie i wyświetlić taki posortowany zbiór danych. Na początku będą te o skrajnie niskich ocenach, na końcu te o skrajnie wysokich ocenach.

```{r, message=FALSE, warning=FALSE, fig.width=7, fig.height=5.5}
arrange(BreakingBad, ocena)
```

# Jak oceniano ten serial?

Dla serialu Breaking Bad mamy dostępną informację o 62 odcinkach. 

Każdy z nich ma określoną średnią ocenę, ale czasem chcielibyśmy myśleć o wszystkich odcinkach jak o pewnej całości. Czy cały serial jest dobry czy nie?

Jak podsumować oceny z 62 odcinków? 

Dwa najpopularniejsze podejścia to średnia oraz mediana (czyli element środkowy). Można je prosto wyznaczyć funkcjami `mean()` i `median()`.

```{r, message=FALSE, warning=FALSE, fig.width=7, fig.height=5.5}
mean(BreakingBad$ocena)
median(BreakingBad$ocena)
```

Mediana to wartość, która po posortowaniu całego wektora znajduje się w środku (lub dla parzystej liczby wartości, jest to średnia z dwóch środkowych wartości).

Więcej informacji niż sama średnia czy mediana, niesie tak zwanych pięć liczb Tukeya. Można je wyznaczyć (razem ze średnią arytmetyczną) funkcją `summary()`. Te pięć liczb przedstawia: 

- `Min` ocenę najgorszego odcinka, 
- `Max` ocenę najlepszego odcinka,
- `Median` ocenę środkowego odcinka (jeżeli jest nieparzysta liczba odcinków) lub średnią z dwóch środkowych odcinków (jeżeli jest parzysta liczna odcinków),
- `1st Qu.` i `3rd Qu.`, czyli oceny ćwiartkowe (połowa obserwacji od minimum do mediany i od mediany do maksimum).

Pięć liczb Tukeya dzieli wartości na cztery równoliczne grupy.

```{r, message=FALSE, warning=FALSE, fig.width=7, fig.height=5.5}
summary(BreakingBad$ocena)
```

# Pięć liczb - wykres pudełko wąsy

Pięć liczb Tukeya można przedstawić graficznie. Służy do tego wykres nazywany pudełko-wąsy lub ramka-wąsy lub z angielskiego boxplot.

Jest na tym wykresie pięć poziomych odcinków i każdy odpowiada jednej z pięciu liczb Tukeya.

Pomiędzy sąsiednimi poziomymi liniami mieści się tyle samo wartości. Jeżeli jednej z tych odcinków jest dłuższy niż pozostałe, to oznacza że wartości w nim są rzadsze niż w innych.

```{r, message=FALSE, warning=FALSE, fig.width=7, fig.height=5.5}
boxplot(BreakingBad$ocena )
```

# Pięć liczb - wykres pudełko wąsy

Zaletą wykresu pudełko - wąsy jest to, że pozwala łatwiej i lepiej porównać grupy obserwacji.

Zobaczmy jak oceny odcinków różnią się pomiędzy sezonami.

Jak to zrobić w programie R? W funkcji `boxplot()` użyjemy znaku formuły `~` aby określić, że chcemy przedstawiać oceny w podziale na sezony. Lewa strona tego symbolu określa zmienną którą chcemy podsumować, a prawa strona określa grupy, które chcemy porównać.

Co możemy odczytać z takiej reprezentacji danych? Naprawdę wiele rzeczy. Spróbujmy zmierzyć się z tym zagadnieniem przez chwilę samodzielnie. Na poniższym wykresie znajdźmy trzy ciekawe obserwacje.

```{r, message=FALSE, warning=FALSE, fig.width=7, fig.height=5.5}
BreakingBad$sezon <- droplevels(BreakingBad$sezon)
boxplot(BreakingBad$ocena ~ BreakingBad$sezon)
```

# Pięć liczb - wykres pudełko wąsy

Co ciekawego udało się znaleźć? Dla mnie najciekawsze obserwacje to:

1. Najlepsze oceny ma sezon 5. Jego mediana jest powyżej całego pudełka dla sezonów 1 i 2, co oznacza, że ponad połowa odcinków z sezonu 5 była wyżej oceniana niż najlepszy z odcinków z pierwszych dwóch sezonów.

2. Najsłabsze wyniki notuje sezon 3. W nim to znajduje się odcinek najgorzej oceniany. Również dla tego sezonu obserwujemy najniższą medianę.

3. Największą zmienność obserwuje się dla sezonu 4. Był w nim i bardzo słaby odcinek (jak na ten serial) i bardzo dobry odcinek.

```{r, message=FALSE, warning=FALSE, fig.width=7, fig.height=5.5, echo=FALSE}
boxplot(BreakingBad$ocena ~ BreakingBad$sezon)
```

# Histogram

Jak inaczej można przedstawić rozkład ocen?

Interesującą alternatywą jest histogram. Zasada prezentacji danych jest następująca:

Dzielimy zakres wartości na pewną liczbę (poniżej na `breaks = 10`) przedziałów o równej długości. Następnie w każdym przedziale sprawdzamy ile wartości do niego wpada. Na wykresie oznaczamy wysokością słupka liczbę obserwacji, które wpadły do określonego przedziału.

Im wyższe słupki, tym większe zagęszczenie obserwacji w danym przedziale.

```{r, message=FALSE, warning=FALSE, fig.width=7, fig.height=5.5}
hist(BreakingBad$ocena, breaks = 10, col="grey")
```

# Co może dać nam histogram czego nie dają inne miary?

Histogram jest bardziej skomplikowanym wykresem niż wykres pudełkowy.

Pytanie czy ta komplikacja niesie użyteczną informację?

Tak! Łatwo to zauważyć dla serialu *The Shield*. Patrząc na histogram dostrzeżemy, że jest grupa odcinków o ocenach w okolicy 5-5.5, jest też grupa odcinków o ocenach w przedziale 7.5-9. Za to nie ma odcinków o ocenie pomiędzy 5.5 a 7.

Takiej informacji nie sposób odczytać ze zwykłego wykresu ramka-wąsy.

```{r, message=FALSE, warning=FALSE, fig.width=7, fig.height=5.5, eval=FALSE}
TheShield <- filter(serialeIMDB, serial == "The Shield")
hist(TheShield$ocena, 10, col="grey")
boxplot(TheShield$ocena, col="grey", range = 10)
```
```{r, message=FALSE, warning=FALSE, fig.width=6, fig.height=5.5, echo=FALSE}
TheShield <- filter(serialeIMDB, serial == "The Shield")
hist(TheShield$ocena, 10, col="grey")
boxplot(TheShield$ocena, col="grey", range = 10)
```

---

# Podsumowanie instrukcji R

W tym odcinku omawialiśmy funkcje służące do eksploracji liczbowej i graficznej danych ilościowych.

```{r, eval=FALSE}
# pakiet z danymi
library(PogromcyDanych)

# wielkość danych i kilka pierwszych wierszy
dim(serialeIMDB)
head(serialeIMDB)

# wartości zmiennych jakościowych
levels(serialeIMDB$serial)

# jak wyznaczyć tabelę liczebności i ją posortować
tabela <- table(serialeIMDB$serial)
sort(tabela, decreasing = TRUE)

# wybieramy tylko dane dotyczące serialu Breaking Bad
BreakingBad <- filter(serialeIMDB, serial == "Breaking Bad") 
# o ilu odcinkach dostępna jest informacja dla tego serialu? 
dim(BreakingBad)

# różne sposoby oglądania informacji o odcinkach
BreakingBad$ocena
barplot(BreakingBad$ocena)
plot(BreakingBad$ocena)
```

# Podsumowanie instrukcji R

W tym odcinku omawialiśmy funkcje służące do eksploracji liczbowej i graficznej danych ilościowych.

```{r, eval=FALSE}
# sortowanie danych
arrange(BreakingBad, ocena)

# podsumowanie danych o ocenach
summary(BreakingBad$ocena)

# wykres pudełkowy
boxplot(BreakingBad$ocena )

# wykres pudełkowy dla grup
BreakingBad$sezon <- droplevels(BreakingBad$sezon)
boxplot(BreakingBad$ocena ~ BreakingBad$sezon)

# histogram a więc pełna informacja o rozkładzie
hist(BreakingBad$ocena, 10, col="grey")

# kiedy histogram zdradza dodatkowe informacje
TheShield <- filter(serialeIMDB, serial == "The Shield")
hist(TheShield$ocena, 10, col="grey")
boxplot(TheShield$ocena, col="grey", range = 10)
```

# Zadania

- Wybierz serial *Friday Night Lights* zobacz jak wygląda popularność tego serialu. Czy jest bardziej popularny niż *Breaking Bad*?

- Zobacz jak popularność tego serialu zmieniała się w czasie. Czy zaobserwowałeś coś interesującego?

- Zamiast prezentować informacje o ocenach odcinków przedstaw informacje o liczbie oddanych głosów (popularności) odcinków. Czy te same statystyki nadają się równie dobrze do prezentacji informacji o ocenie i o liczbie głosów?

