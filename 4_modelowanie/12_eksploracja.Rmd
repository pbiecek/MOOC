---
title: "Eksploracja danych"
author: "pogRomcy danych"
date: "sezon 2 / odcinek 12<br><br> Wszelkie prawa zastrzeżone.<br> Wykorzystanie możliwe wyłącznie za zgodą autora.  <br><br><br><br>Naciśnij `A` by zamienić slajdy na ciągły tekst. <br> Naciśnij `T` by wyświetlić spis treści."
output:
  slidy_presentation:
    includes:
      in_header: ../tracking.html
    highlight: default
    css: ../style.css
    font_adjustment: 0
    footer: "pogRomcy danych / modelowanie / eksploracja"

---

```{r, echo=FALSE}
library(knitr)
opts_chunk$set( message=FALSE,tidy.opts=list(keep.blank.line=TRUE, width.cutoff=120),options(width=120))
```

# O czym jest ten odcinek?

Pierwszy etap analizy danych to eksploracja. 

Pierwsze spojrzenie na dane. Sprawdzenie z jakimi zmiennymi, z jakimi zakresami mamy do czynienia.

W tym celu najczęściej ogląda się każdą zmienną osobno, ewentualnie parami, bazując na prostych podsumowaniach graficznych lub tabelarycznych.

W tym odcinku pokażemy jak przedstawiać rozkład zmiennej ciągłej oraz zmiennej dyskretnej, za pomocą kilku popularnych statystyk. Dla zmiennej ciągłej

- średniej, mediany,
- pięciu liczb Tukeya,
- wykresu ramka wąsy, histogramu.

Dla zmiennej dyskretnej

- tablicy kontyngencji.


---

# Baza danych o filmach i serialach

W bazie danych o filmach IMDB (Internet Movie Database) znaleźć można dane o serialach a w szczególności średnie oceny użytkowników wystawione kolejnym odcinkom serialu.

Przykładowo, na stronie http://www.imdb.com/title/tt0903747/epdate?ref_=ttep_ql_4 znajdują się oceny serialu *Breaking Bad*.

Dane te zostały pobrane z Internetu i przygotowane tak, że teraz są dostępne w zbiorze danych `serialeIMDB` w pakiecie `PogromcyDanych`, który towarzyszy temu kursowi. Ten zbiór danych składa się z ponad 20 tysięcy wierszy oraz 8 kolumn/zmiennych. Przyjrzyjmy się tym kolumnom po kolei.

```{r, warning=FALSE, message=FALSE}
library(PogromcyDanych)

dim(serialeIMDB)
head(serialeIMDB)
```

---

# Seriale

Każdy wiersz w zbiorze danych `serialeIMDB` opisuje oceny jednego odcinka jednego z przeszło 200 seriali.

Kolumna danych o nazwie `serial` jest zmienną jakościową, przyjmującą za wartości nazwy seriali. Listę poziomów zmiennej jakościowej można wyświetlić funkcją `levels()`.

```{r, message=FALSE, warning=FALSE, fig.width=7, fig.height=5.5}
levels(serialeIMDB$serial)
```

---

# Tabela liczebności

Inną użyteczną funkcją dla zmiennych jakościowych jest tabela częstości, przedstawiającą jak często określona wartość występuje w wektorze.

Tabelę częstości można wyznaczyć funkcją `table()`. Wynik tej funkcji można wyświetlić na ekranie, lub jak w poniższym przykładzie zapisać do zmiennej.

```{r, message=FALSE, warning=FALSE, fig.width=7, fig.height=5.5}
tabela <- table(serialeIMDB$serial)
```

Tabelę liczebności dla 200 rozkładów trudno się przegląda. Jeżeli interesują nas najczęstsze lub najrzadsze wartości to aby je odczytać warto tabelę liczebności posortować.

```{r, message=FALSE, warning=FALSE, fig.width=7, fig.height=5.5}
sort(tabela, decreasing = TRUE)
```

---

# Breaking Bad

Praca na zbiorze danych o wszytkich odcinakch jest trudniejsza, ponieważ nei jesteśmy w stanie ogarnąć wzrokiem wszystkich 20 tysięci wuerszy.

Dlatego na potrzeby dalszych przykładów wybierzmy z tego zbioru danych jeden serial, któremu przyjrzymy się bliżej.

```{r,  message=FALSE, warning=FALSE, fig.width=7, fig.height=5.5}
BreakingBad <- filter(serialeIMDB, serial == "Breaking Bad") 

filter(serialeIMDB, serial == "Star Trek: The Next Generation") 
# o ilu odcinkach dostępna jest informacja dla tego serialu? 
dim(BreakingBad)
```

# Co się dzieje z ocenami odcinków?

Z pewnością interesującą informacją jest to jak dany serial oceniano.

Ta informacja dostępna jest w kolumnie `ocena` i można się do niej dostać odwołując się do tej kolumny operatorem `$`.

Ale przecież każdy odcinek podobał się inaczej, jeden bardziej inny mniej. 
Porównajmy trzy sposoby przedstawienia informacji o ocenach.
Czy któryś z tych sposobów prezentacji liczb pozwala na zauważenie czegoś ciekawego?

Wektor liczb

```{r, message=FALSE, warning=FALSE, fig.width=8, fig.height=6}
BreakingBad$ocena
```

Wykres słupkowy

```{r, message=FALSE, warning=FALSE, fig.width=8, fig.height=6}
barplot(BreakingBad$ocena)
```

Wykres punktowy

```{r, message=FALSE, warning=FALSE, fig.width=8, fig.height=6}
plot(BreakingBad$ocena)
```

Wykres punktowy, jako jedyny z powyższych pozwala na łatwe zauważenie, że od odcinka 45 oceny odcinków się poprawiły. 

Dlaczego ten informacji nie widać tak łatwo na innych wykresach?

# Sortowanie

Często interesujące są obserwacje skrajne. Jak najłatwiej się zorientować które odcinki uzyskują skrajne oceny?

Najłatwiej posortować odcinki po ocenie i wyświetlić taki posortowany zbiór danych.

```{r, message=FALSE, warning=FALSE, fig.width=7, fig.height=5.5}
arrange(BreakingBad, ocena)
```

# Jak oceniano ten serial

Dla serialu Breaking Bad mamy dostępną informację o 62 odcinkach, ale czasem chcielibyśmy myśleć o nich jak o pewnej całości. Czy cały serial jest dobry czy nie?

Jak podsumować oceny z 62 odcinków? 

Dwa najpoopularniejsze podejscia to średnia oraz mediana (czyli element środkowy). Można je prosto wyznaczyć ale często nie mówią wielu interesujących aspektów o danych. Np jakich?

```{r, message=FALSE, warning=FALSE, fig.width=7, fig.height=5.5}
mean(BreakingBad$ocena)
median(BreakingBad$ocena)
```

Wiele informacji niesie tak zwanych pięć liczb Tukeya oraz średnia. Średnia (`Mean`) to średnia arytmetyczna z wszystkich ocen. Pozostałe pięć liczb przedstawiają: 

- `Min` ocenę najgorszego odcinka, 
- `Max` ocenę najlepszego odcinka,
- `Median` ocenę środkowego odcinka (jeżeli jest nieparzysta liczba odcinków) lub średnią z dwóch środkowych odcinków (jeżeli jest parzysta liczna odcinków),
- `1st Qu.` i `3rd Qu.`, czyli oceny ćwiartkowe (połowa obserwacji od minimum do mediany i od mediany do maksimum).

```{r, message=FALSE, warning=FALSE, fig.width=7, fig.height=5.5}
summary(BreakingBad$ocena)
```

# Pięć liczb - wykres pudełko wąsy

Pięć liczb Tukeya można przedstawić graficznie. 

Służy do tego wykres nazywany pudełko-wąsy lub ramka-wąsy lub z angielskiego boxplot.

Jest na tym wykresie pięć poziomych linii i każda odpowiada jednemu kwartylowi.

```{r, message=FALSE, warning=FALSE, fig.width=7, fig.height=5.5}
boxplot(BreakingBad$ocena )
```

# Pięć liczb - wykres pudełko wąsy

Zaletą wykresu pudełko - wąsy jest to, że pozwala łatwiej i lepiej porównać grupy obserwacji.

Zobaczmy jak oceny odcinków różnią się pomiędzy sezonami.

W funkcji `boxplot()` użyjemy znaku formuły `~` aby określić, że chcemy przedstawiać oceny w podziale na sezony.

Co możemy odczytać z takiej reprezentacji danych? Naprawdę wiele rzeczy, znajdźmy trzy ciekawe obserwacje.

```{r, message=FALSE, warning=FALSE, fig.width=7, fig.height=5.5}
BreakingBad$sezon <- droplevels(BreakingBad$sezon)
boxplot(BreakingBad$ocena ~ BreakingBad$sezon)
```

Jedną jest to, że najlepsze oceny ma sezon 5. Jego mediana jest powyżej całego pudełka dla sezonów 1 i 2, co oznacza, że ponad połowa odcinków z sezonu 5 była wyżej oceniana niż najlepszy z odcinków z pierwszych dwóch sezonów.

Najsłabsze wyniki notuje sezon 3. W nim to znajduje się odcinek najgorzej oceniany. Też dla niego mediana jest najniżej.

Największą zmienność obserwuje się dla sezonu 4. Był w nim i bardzo słaby odcinek (jak na ten serial) i bardzo dobry odcinek.

# Histogram

Jak inaczej można przedstawić rozkład ocen?

Interesującą alternatywą jest histogram.

```{r, message=FALSE, warning=FALSE, fig.width=7, fig.height=5.5}
hist(BreakingBad$ocena, 10, col="grey")
```

# Co może dac nam histogram czego nie dają inne miary?

```{r, message=FALSE, warning=FALSE, fig.width=7, fig.height=5.5}
TheShield <- filter(serialeIMDB, serial == "The Shield")
hist(TheShield$ocena, 10, col="grey")
boxplot(TheShield$ocena, col="grey", range = 10)
```

---

# Podsumowanie instrukcji R

W tym odcinku omawialiśmy funkcje służące do eksploracji liczbowej i graficznej danych ilościowych.

```{r, eval=FALSE}
# pakiet z danymi
library(PogromcyDanych)

# wielkość danych i kilka pierwszych wierszy
dim(serialeIMDB)
head(serialeIMDB)

# wartości zmiennych jakościowych
levels(serialeIMDB$serial)

# jak wyznaczyć tabelę liczebności i ją posortować
tabela <- table(serialeIMDB$serial)
sort(tabela, decreasing = TRUE)

# wybieramy tylko dane dotyczące serialu Breaking Bad
BreakingBad <- filter(serialeIMDB, serial == "Breaking Bad") 
# o ilu odcinkach dostępna jest informacja dla tego serialu? 
dim(BreakingBad)

# różne sposoby oglądania informacji o odcinkach
BreakingBad$ocena
barplot(BreakingBad$ocena)
plot(BreakingBad$ocena)
```

# Podsumowanie instrukcji R

W tym odcinku omawialiśmy funkcje służące do eksploracji liczbowej i graficznej danych ilościowych.

```{r, eval=FALSE}
# sortowanie danych
arrange(BreakingBad, ocena)

# podsumowanie danych o ocenach
summary(BreakingBad$ocena)

# wykres pudełkowy
boxplot(BreakingBad$ocena )

# wykres pudełkowy dla grup
BreakingBad$sezon <- droplevels(BreakingBad$sezon)
boxplot(BreakingBad$ocena ~ BreakingBad$sezon)

# histogram a więc pełna informacja o rozkładzie
hist(BreakingBad$ocena, 10, col="grey")

# kiedy histogram zdradza dodatkowe informacje
TheShield <- filter(serialeIMDB, serial == "The Shield")
hist(TheShield$ocena, 10, col="grey")
boxplot(TheShield$ocena, col="grey", range = 10)
```

# Zadania

- Wybierz serial *Friday Night Lights* zobacz jak wygląda popularność tego serialu. Czy jest bardziej popularny niż *Breaking Bad*?

- Zobacz jak popularność tego serialu zmieniała się w czasie. Czy zaobserwowałeś coś interesującego?

- Zamiast prezentować informacje o ocenach odcinków przedstaw informacje o liczbie oddanych głosów (popularności) odcinków. Czy te same statystyki nadają się równie dobrze do prezentacji informacji o ocenie i o liczbie głosów?

