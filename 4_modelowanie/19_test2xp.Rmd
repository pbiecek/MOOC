---
title: "Zależność pomiędzy dwiema zmiennymi jakościowymi"
author: "pogRomcy danych"
date: "sezon 2 / odcinek 19<br><br><a href='http://biecek.pl/'>Przemysław Biecek @ Uniwersytet Warszawski</a><br><br>Naciśnij `A` by zamienić slajdy na ciągły tekst. <br> Naciśnij `T` by wyświetlić spis treści."
output:
  slidy_presentation:
    includes:
      in_header: ../tracking.html
    highlight: default
    css: ../style.css
    font_adjustment: 0
    footer: "pogRomcy danych / modelowanie / testy kxp"
---

# O czym jest ten odcinek

W poprzednim odcinku pokazaliśmy jak badać zależność pomiędzy dwoma zmiennymi binarnymi. 

A co w sytuacji gdy zmienne nie są binarne? Temu tematowi poświęcony jest ten odcinek.

W tym odcinku nauczymy się jak:

- jak budować i jak czytać tablice kontyngencji dla pary zmiennych jakościowych
- jak przedstawiać graficznie tabelę kontyngencji
- jak statystycznie testować zależność pomiędzy parą zmiennych.

Do ilustracji tych zagadnień wykorzystamy dwa zbiory danych. Pierwszy, to dane z Diagnozy Społecznej, dostępne w tabeli `diagnoza` a drugi o nowotworze piersi, dostępne w tabeli `TCGA_BRCA`, oba dostępne w pakiecie `PogromcyDanych`.



# Wczytanie danych

Dane od których rozpoczniemy przykłady to `diagnoza` z pakietu `PogromcyDanych`. Aby te dane wczytać, wystarczy włączyć ten pakiet - instrukcja jak to zrobić znajduje się w odcinku 2 pierwszego sezonu.

W zbiorze danych `diagnoza` dostępnych jest kilkadziesiąt kolumn, opisujących odpowiedzi na różne interesujące pytania. W tym odcinku przyjrzymy się tylko kilku  wybranym kolumnom, opisującym imię, wiek, płeć, ukończoną edukację oraz odpowiedź na pytanie ,,Co jest według Pana ważniejsze w życiu?'' (zmienna w kolumnie `gp29`) z możliwymi odpowiedziami *Poczucie sensu* i *Przyjemności*.

```{r, warning=FALSE, message=FALSE}
library(PogromcyDanych)
diagnoza[1:6, c("imie_2011", "wiek2013", "plec", "eduk4_2013", "gp29")]
```

# Jak wygląda tabela kontyngencji dla wykształcenia

W poprzednim odcinku przyglądaliśmy się parze zmiennych `plec`, czyli płeć respondenta i `gp29`, czyli odpowiedź na pytanie co jest ważniejsze w życiu.
 
W tym odcinku przyjrzymy się zależności pomiędzy  poziomem edukacji (zmienna `eduk4_2013`) a odpowiedziami na pytanie o to co jest ważniejsze w życiu.

Zobaczmy jak wygląda tablica kontyngencji, zestawiająca te dwie zmienne.
 
```{r}
table(diagnoza$eduk4_2013, diagnoza$gp29)
```

Zmienna `eduk4_2013` poza czterema poziomami edukacji ma też piąty poziom `BD/ND/FALA`, który w tych danych nie występuje. Najłatwiej go usunąć funkcją `droplevels()`.

```{r}
(edukacjaTab <- table(droplevels(diagnoza$eduk4_2013), diagnoza$gp29))
```

W każdej grupie wykształcenia respondenci częściej deklarują, że ważniejsze jest poczucie sensu. 
Ale czy są różnice pomiędzy grupami wykształcenia są duże?

# Jak wygląda tabela kontyngencji dla wieku

Zobaczmy jak wygląda zależność pomiędzy wiekiem a odpowiedziami na pytanie o sens w życiu.

Wiek jest zmienną ciągłą, zamienimy więc ją na zmienną jakościową o czterech poziomach.
Aby zdyskretyzować zmienną ciągłą na dyskretną wykorzystamy funkcję `cut()` w której za granice przedziałów wiekowych wybierzemy 0, 25, 40, 60 i 110 lat.
 
```{r}
diagnoza$wiek2013_4g <- cut(diagnoza$wiek2013, c(0, 25, 40, 60, 110))
table(diagnoza$wiek2013_4g)
```

Przedstawmy teraz jak wygląda zależność pomiędzy wiekiem a odpowiedziami na pytani o to co jest ważniejsze w życiu?

```{r}
wiekTab <- table(diagnoza$wiek2013_4g, diagnoza$gp29)
wiekTab
```

# Proporcje

Używając funkcji `prop.table()` można wyznaczyć frakcje w wierszach lub kolumnach.

Zobaczmy jak wyglądają proporcje odpowiedzi na pytanie o poczucie sensu w różnych grupach edukacji i wieku.

```{r}
prop.table(edukacjaTab, 1)
prop.table(wiekTab, 1)
```

# Wykresy mozaikowe

Tabele częstości można przedstawić graficznie.

Często wykorzystuje się do tego wykres mozaikowy. Pola kwadratów oznaczają liczbę odpowiedzi w tej kombinacji cech. Względne wysokości słupków odpowiadają względnym proporcjom w grupach określonych przez kolumny.

```{r, warning=FALSE, message=FALSE}
mosaicplot(edukacjaTab, las=2, main="Edukacja vs. co jest ważne w życiu")
mosaicplot(wiekTab, las=2, main="Wiek vs. co jest ważne w życiu")
```

# Więcej kolumn / wierszy

A teraz wykonajmy modelowanie dla innej zmiennej. Np. zobaczmy na ile identyfikacja z pytanie, *Podziwiam ludzi, którzy mają drogie domy, samochody i ubrania* koreluje z wiekiem (więcej informacji o pytaniach znaleźć można w kwestionariuszu kwestionariusza http://diagnoza.com/pliki/kwestionariusze_instrukcje/kwestionariusze_2013.pdf).

Pytanie dotyczy odpowiedzi na pytanie *Niektórzy są więcej warci od innych*

```{r, warning=FALSE, message=FALSE, fig.width=7, fig.height=5}
wiekPodziwiam <- table(diagnoza$gp54_13, diagnoza$wiek2013_4)
wiekPodziwiam

# zależnosć przedstawiona graficznie
mosaicplot(t(wiekPodziwiam), las=2,
           col=c("red4","red1","pink","grey80","lightgreen","green1","green4"),
           main="Podziwiam ludzi, którzy mają drogie domy, samochody i ubrania")
```

# Czy jest zależność?

Aby sprawdzić, czy pomiędzy parą zmiennych jakościowych jest zależność, można wykonać test $\chi^2$.

Sprawdza on na ile obserwowana tabela częstości jest daleka od takiej, którą byśmy obserwowali, gdyby zmienne nie były zależne.

Test $\chi^2$ wykonuje się funkcją `chisq.test()`. Wynikiem jest p-wartość dla hiptoezy o niezależności. Małe p-wartości (zwyczajowo poniżej 0.05) interpretuje się jako przesłanki o zależności pomiędzy zmiennymi.

```{r, warning=FALSE, message=FALSE, fig.width=7, fig.height=5}
wiekPodziwiam <- table(diagnoza$gp54_13, diagnoza$wiek2013_4)
chisq.test(wiekPodziwiam)
```

# Czy jest zależność?

Z wyniku funkcji `chisq.test()` można też odczytać, jak wyglądają obie porównywane tabele.

W polu `observed` znajduje się tabela częstości obserwowana w danych.

```{r, warning=FALSE, message=FALSE, fig.width=7, fig.height=5}
chisq.test(wiekPodziwiam)$observed
```

A w polu `$expected` znajduje się tabela częstości oczekiwanych, gdyby nie było żadnej zależności.

```{r, warning=FALSE, message=FALSE, fig.width=7, fig.height=5}
chisq.test(wiekPodziwiam)$expected
```

Jeżeli te tabele są daleko od siebie, to jest to przesłanka, że zmienne są zależne (=nie są niezależne).

# Zadanie

W zbiorze danych `TCGA_BRCA` zbadaj czy jest i jaka jest zależność pomiędzy 

+ przeżyciami (kolumna `czy.zyje` a mutacjami `TP53`),
+ płcią a mutacjami `TP53`,
+ płcią a zmienną `czy.zyje`.

Zależność przedstaw za pomocą tabeli z liczebnościami oraz częstościami.


