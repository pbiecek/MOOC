---
title: "Zależność pomiędzy dwoma zmiennymi jakościowymi"
author: "pogRomcy danych"
date: "sezon 3 / odcinek 3<br><br> Wszelkie prawa zastrzeżone.<br> Wykorzystanie możliwe wyłącznie za zgodą autora.  <br><br><br><br>Naciśnij `A` by zamienić slajdy na ciągły tekst. <br> Naciśnij `T` by wyświetlić spis treści."
output:
  slidy_presentation:
    includes:
      in_header: ../tracking.html
    highlight: default
    css: ../style.css
    font_adjustment: 0
    footer: "pogRomcy danych / pierwsze kroki / testy kxp"
---

# O czym jest ten odcinek

W poprzednim odcinku pokazaliśmy jak badać zależność pomiędzy dwoma zmiennymi binarnymi. 

A co w sytuacji gdy zmienne nie są binarne? Temu tematowi poświęcony jest ten odcinek.

W tym odcinku nauczymy się jak:

- jak budować i jak czytać tablice kontyngencji dla pary zmiennych jakościowych
- jak przedstawiać graficznie tabelę kontyngencji
- jak statystycznie testować zależność pomiędzy parą zmiennych.

Do ilustracji tych zagadnień wykorzystamy dwa zbiory danych. Pierwszy, to dane z Diagnozy Społecznej, dostępne w tabeli `diagnoza` a drugi o nowotworze piersi, dostępne w tabeli `TCGA_BRCA`, oba dostępne w pakiecie `PogromcyDanych`.



# Wczytanie danych

Dane od których rozpoczniemy przykłady to `diagnoza` z pakietu `PogromcyDanych`. Aby te dane wczytać, wystarczy włączyć ten pakiet - instrukcja jak to zrobić znajduje się w odcinku 2 pierwszego sezonu.

W zbiorze danych `diagnoza` dostępnych jest kilkadziesiąt kolumn, opisujących odpowiedzi na różne interesujące pytania. W tym odcinku przyjrzymy się tylko kilku  wybranym kolumnom, opisującym imię, wiek, płeć, ukończoną edukację oraz odpowiedź na pytanie ,,Co jest według Pana ważniejsze w życiu?'' (zmienna w kolumnie `gp29`) z możliwymi odpowiedziami *Poczucie sensu* i *Przyjemności*.

```{r, warning=FALSE, message=FALSE}
library(PogromcyDanych)
diagnoza[1:6, c("imie_2011", "wiek2013", "plec", "eduk4_2013", "gp29")]
```

# Jak wygląda tabela kontyngencji dla wykształcenia

W poprzednim odcinku przyglądaliśmy się parze zmiennych `plec`, czyli płeć respondenta i `gp29`, czyli odpowiedź na pytanie co jest ważniejsze w życiu.
 
W tym odcinku przyjrzymy się zależności pomiędzy  poziomem edukacji (zmienna `eduk4_2013`) a odpowiedziami na pytanie o to co jest ważniejsze w życiu.

Zobaczmy jak wygląda tablica kontyngencji, zestawiająca te dwie zmienne.
 
```{r}
table(diagnoza$eduk4_2013, diagnoza$gp29)
```

Zmienna `eduk4_2013` poza czterema poziomami edukacji ma też piąty poziom `BD/ND/FALA`, który w tych danych nie występuje. Najłatwiej go usunąć funkcją `droplevels()`.

```{r}
(edukacjaTab <- table(droplevels(diagnoza$eduk4_2013), diagnoza$gp29))
```

W każdej grupie wykształcenia respondenci częściej deklarują, że ważniejsze jest poczucie sensu. 
Ale czy są różnice pomiędzy grupami wykształcenia są duże?

# Jak wygląda tabela kontyngencji dla wieku

Zobaczmy jak wygląda zależość pomiędzy wiekiem a odpowiedziami na pytanie o sens w życiu.

Wiek jest zmienną ciągłą, zamienimy więc ją na zmienną jakościową o czterech poziomach.
Aby zdyskretyzować zmienną ciągłą na dyskretną wykorzystamy funkcję `cut()` w której za granice przedziałów wiekowych wybierzemy 0, 25, 40, 60 i 110 lat.
 
```{r}
diagnoza$wiek2013_4g <- cut(diagnoza$wiek2013, c(0, 25, 40, 60, 110))
table(diagnoza$wiek2013_4g)
```

Przedstawmy teraz jak wygląda zależność pomiędzy wiekiem a odpowiedziami na pytani o to co jest ważneijsze w życiu?

```{r}
(wiekTab <- table(diagnoza$wiek2013_4g, diagnoza$gp29))
```

# Więcek kolumn / wierszy

Strona 25 z http://diagnoza.com/pliki/kwestionariusze_instrukcje/kwestionariusze_2013.pdf
Pytanie 54

```{r, warning=FALSE, message=FALSE}
table(diagnoza$gp54_13, diagnoza$wiek2013_4)

mosaicplot(t(table(diagnoza$gp54_13, diagnoza$wiek2013_4)), las=2,
           col=c("red4","red1","pink","grey80","lightgreen","green1","green4"),
           main="Niektórzy są więcej warci od innych")

mosaicplot(t(table(diagnoza$gp54_13, droplevels(diagnoza$eduk4_2013))), las=2,
           col=c("red4","red1","pink","grey80","lightgreen","green1","green4"),
           main="Niektórzy są więcej warci od innych")


mosaicplot(t(table(diagnoza$gp54_01, diagnoza$wiek2013_4)), las=2,
           col=c("red4","red1","pink","grey80","lightgreen","green1","green4"),
           main="Podziwiam ludzi, którzy mają drogie domy, samochody i ubrania")

mosaicplot(t(table(diagnoza$gp54_04, diagnoza$wiek2013_4)), las=2,
           col=c("red4","red1","pink","grey80","lightgreen","green1","green4"),
           main="Miarą sukcesu jest sta posiadania dóbr maeterialnych")

mosaicplot(t(table(diagnoza$gp54_19, diagnoza$wiek2013_4)), las=2,
           col=c("red4","red1","pink","grey80","lightgreen","green1","green4"),
           main="Bez kar fizycznych nie da się dobrze wychować dzieci")

mosaicplot(t(table(diagnoza$gp54_17, diagnoza$wiek2013_4)), las=2,
           col=c("red4","red1","pink","grey80","lightgreen","green1","green4"),
           main="Niektóre grupy ludzi nie zasługują na szacunek")

```

# Proporcje

Używając funkcji `prop.table()` można wyznaczyć frakcje w wierszach lub kolumnach.

```{r}
prop.table(edukacjaTab, 1)
prop.table(wiekTab, 1)
```

# Wykresy mozaikowe

```{r, warning=FALSE, message=FALSE}
mosaicplot(edukacjaTab, las=2, main="Edukacja vs. co jest ważne w życiu")
mosaicplot(wiekTab, las=2, main="Wiek vs. co jest ważne w życiu")
```

# O czym jest ten odcinek

Zależność w diagnozie pomiędzy co jest wazne a grupa wiekowa

```{r, eval=FALSE}
table(TCGA_BRCA$czy.zyje,
      TCGA_BRCA$TP53)
prop.table(table(TCGA_BRCA$czy.zyje,
      TCGA_BRCA$TP53), 2)
# brak przerzutow dobrze rokuje
fisher.test(table(TCGA_BRCA$czy.zyje,
      TCGA_BRCA$TP53))
```


