---
title: "Eksploracja / dplyr"
output:
  html_document:
    toc: yes
---

Przygotowując dane do analiz musimy wykonać dwa ważne kroki
* określić w jakim formacie i jakie dane potrzebujemy
* określić w jaki sposób dane przetworzyć do tego formatu.

Oba kroki są ważne!
Dplyr pozwala na wykonanie większości pracy polegającej na przygotowaniu danych za pomocą pięciu mechanizmów, które można ze sboą składać.
Poznamy te pięć klocków poniżej i zobaczymy jak je łączyć ze sobą

Dplyr nie jest jedynym pakietem, wspierającym analizy danych. Ale jest bardzo bardzo szybki i jest kompleksowym rozwiązaniem. Dlatego nauczymy się go używać.

# Wczytanie danych

Każdy wiersz zbioru danych `auta2012` opisuje jedną ofertę sprzedaży auta. Każda kolumna opisuje jedną cechę / właściwość tej oferty.

```{r, warning=FALSE}
library(SmarterPoland)
head(auta2012)
```

## Ramki i tabele danych

Dane surowe mogą mieć różną postać. Mogą to być korpusy tekstów, nagrań audio lub video.
Jednak w analizie danych często sprawodza się dane do postaci tabelarycznej, ponieważ większość funkcji oczekuje takiego formatu danych.

Podstawowym typem danych, przechowujących dane w postaci tabelarycznej jest typ `data.frame`. Dane mają postać tabeli w której w każdej kolumnie są wartości tego samego typu (np. liczby, napisy, wartości logiczne).

Odwołując się do elementów tabeli korzysta się ze składni `tabela[ktore_wiersze, ktore_kolmny]`.

Przykładowo, wybranie 3 wiersza z naszej tabeli liczb wyglądałoby tak

```{r, warning=FALSE}
auta2012[3,]
```

A wiersze od 3 do 5?

```{r, warning=FALSE}
auta2012[3:5,]
```

Podobnie możemy odwoływać się do kolumn i obu wymiarów jednocześnie.

```{r, warning=FALSE}
auta2012[3:5, 2:4]
```


## Filtrowanie danych
Używając funkcji filter() można przefiltrować dane, zostawiając tylko te, któ®e spełniają określony warunek (jeden lub kilka).
Pierwszym argumentem tej funkcji jest ramka danych,
kolejne argumenty, a może być ich jeden lub więcej) to warunki logiczne, które muszę być spełnione aby dany wiersz trafił do wyniki.

Jeżeli chcemy pozostawić tlyko samochody marki Audi, możemy uzyć warunku `Marka == 'Audi'`.

```{r, warning=FALSE}
tylkoAudi <-
  filter(auta2012,
       Marka == "Audi")
```

Memy określać jednocześnie więcej warunków.
Na przykłąd tylko samochody Audi o silnikach o liczbie koni mechanicnzych przekraczających 200 możemy odfiltrować w następujący sposób.

```{r, warning=FALSE}
tylkoAudiZDużymSilnikiem <-
  filter(auta2012,
       Marka == "Audi",
       KM > 200)
```

### Zadania:
+ Ze zbioru danych `auta2012` pozostaw tylko samochody o wieku do pięciu lat (czyli o roku produkcji > 2007). Nazwij ten wynikowy zbiór danych `mlodeAuta`
+ Z przed chwilą stworzonego zbioru danych `mlodeAuta` wybierz tylko Fiaty 500. Ile jest takich aut? 
(wymiary ramki danych możesz sprawdzić funkcją dim())


## Sortowanie danych
arrange()
```{r, warning=FALSE}
```

## Przetwarzanie potokowe, `%>%`
```{r, warning=FALSE}
```

## select() (and rename()) [contains, starts_with, ends_with, matches]?
```{r, warning=FALSE}
```
## mutate() (and transmute())
```{r, warning=FALSE}
```


## group_by()
## summarise()
## n()
## first() last()
## summarise()







### Zadania:
+ Sprawdź ile samochodów ma zainstalowany autoalarm **PCH: (oznaczony jako 'autoalarm')**
+ Sprawdź ile samochodów ma lakier w metalicznym kolorze **PCH: (oznaczony jako 'metallic')**

### Odpowiedzi:
+ `r sum(grepl(auta2012$Wyposazenie.dodatkowe.napis, pattern="autoalarm"))`
+ `r sum(grepl(as.character(auta2012$Kolor), pattern="metallic"))`


