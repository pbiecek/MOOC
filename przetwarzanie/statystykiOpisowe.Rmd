---
title: "Statystki opisowe"
output:
  html_document:
    toc: yes
---

Czas na poznanie rodzajów danych, na jakie możemy się natknąć.

W trakcie tych zajęć przedstawimy cztery podstawowe typy danych, dane ilościowe, jakościowe, napisy i wartości logiczne.
Słowo typ, ma w tym przypadku to samo znaczenie co słowo rodzaj, ale jest częściej stosowane w analizie danych, dlatego będziemy poniżej mówić o czterech podstawowych typach.

Ale zanim dojdziemy do typów, wczytajmy dane

# Wczytanie danych

Na poprzednich zajęciach poznaliśmy kilka sposobów na wczytanie danych do R. 
Wczytajmy dane w formacie tekstowym używając funkcji `read.table()`.
Następnie używając funkcji `head()` by wyświetlić pierwsze dwa wiersze.

```{r, warning=FALSE}
auta2012 = read.table("http://biecek.pl/MOOC/dane/auta2012.csv",
                       sep=";", dec=",", header=TRUE)
head(auta2012, 2)
```

Każdy wiersz tego zbioru danych opisuje jedną ofertę sprzedaży auta. Każda kolumna opisuje jedną cechę / właściwość tej oferty.

# Cechy ilościowe
Przyjrzyjmy się takim cechom jak _Cena.w.PLN_ lub _Przebieg.w.km_. Cechy te są opisane przez liczby oraz przedstawiają ilości. 
Pierwsza z nich przedstawia _ilość_ pieniędzy, za którą sprzedawca chce sprzedać samochód, druga opisuje _ilość_ kilometrów, którą przejechał wystawiony na aukcji samochód. 

## Statystyki opisowe

Na zmiennych ilościowych wykonać możemy kilka operacji. 
Używając funkcji `mean()` możemy policzyć średnią cenę wystawionych aut.

```{r, warning=FALSE}
mean(auta2012$Cena.w.PLN)
```

Używając funkcji `min()` i `max()` możemy wyznaczyć minimalną i maksymalną cenę w tym zbiorze danych.

```{r, warning=FALSE}
min(auta2012$Cena.w.PLN)
max(auta2012$Cena.w.PLN)
```

Używając funkcji `summary()` możemy wyznaczyć sześć podstawowych charakterystyk, czyli: minimum, 1. kwartyl, medianę (2. kwwartyl), średnią, 3. kwartyl i maksimum.

*Kwartyle dzielą wektor na cztery równoliczne części.*
+ Jedna czwarta samochodów ma cenę niższą od 1. kwartyla.
+ Jedna czwarta samochodów ma cenę wyższą od 1. kwartyla ale niższą od mediany (2. kwartyla).
+ Jedna czwarta samochodów ma cenę wyższą od mediany (2. kwartyla) ale niższą od 2. kwartyla.
+ Jedna czwarta samochodów ma cenę wyższą od 3. kwartyla.

```{r, warning=FALSE}
summary(auta2012$Cena.w.PLN)
```

### Zadania:
+ W zbiorze danych _auta2012_ aż 7 cech to cechy ilościowe. Wymień które.
+ Jedną z cech ilościowych jest _Rok.produkcji_. Jaki jest medianowy/połówkowy rok produkcji oferowanych aut? Wszystkie te oferty były złożone w roku 2012, jaki był medianowy/połówkowy wiek oferowanego auta?

### Odpowiedzi:
+ `Cena`, `Cena.w.PLN`, `KM`, `kW`, `Pojemnosc.skokowa`, `Przebieg.w.km`, `Rok.produkcji`
+ `r median(auta2012$Rok.produkcji, na.rm=TRUE)` rok

## Brakujące dane
Może się tak zdarzyć, że oferta sprzedaży nie zawiera wszystkich informacji o aucie. Np. brakuje informacji o przebiegu. 
Takie braki danych trzeba jakoś oznaczyć. Nie można w ich miejsce wstawić np. 0, ponieważ czymś innym jest przebieg równy 0 a czymś innym jest brak informacji o przebiegu.

Potrzebna jest więc jakaś specjalna wartość, która będzie oznaczała brakujące wartości. W programie R taką wartością jest `NA` (skrót od _non available_, czyli _niedostępne_).

Jak zauważyć, że w danych występują wartości niedostępne? 
Ich liczba będzie wymieniona w wyniku funkcji `summary()`. Dla zmiennej `Przebieg.w.km` brakujących wartości jest 20 711.

```{r, warning=FALSE}
summary(auta2012$Przebieg.w.km)
```

Jakie są konsekwencje występowania brakujących wartości?
Część statystyk nie można policzyć.
Przykładowo, średnia z 1 i 3 to 2.
Ale ile wynosi średnia z 1 i _nie wiadomo_? 

Dlatego gdy liczmy średnie lub inne statystyki z takich wektorów to wynik jest wartością `NA`.

```{r, warning=FALSE}
mean(auta2012$Przebieg.w.km)
min(auta2012$Przebieg.w.km)
max(auta2012$Przebieg.w.km)
```

To logiczne. Jeżeli nie wszystkie wartości są znane, to nie można policzyć ani średniej ani minimum ani maksimum.

Logiczne ale też mało praktyczne. 
Często chcielibyśmy policzyć średnią, medianę, minimum tylko z tych wartości które są znane.

Aby to zrobić w programie R, do funkcji należy dodać argument `na.rm=TRUE`, gdzie `na.rm` to skrót od _remove NA_, czyli usuń wartości brakujące.

```{r, warning=FALSE}
mean(auta2012$Przebieg.w.km, na.rm=TRUE)
min(auta2012$Przebieg.w.km, na.rm=TRUE)
max(auta2012$Przebieg.w.km, na.rm=TRUE)
```

### Zadania:
+ Która cecha jest najmniej kompletna? Dla której cechy liczba brakujących wartości jest największa?
+ Jaka jest mediana/połówkowa wielkość silnika (`Pojemnosc.skokowa`)?

### Odpowiedzi:
+ Dla zmiennej `Przebieg.w.km`  jest `r sum(is.na(auta2012$Przebieg.w.km))` 20 711 brakujących wartości. Ta zmienna jest najmniej kompletna.
+  `r median(auta2012$KM, na.rm=TRUE)` cm3

## Graficzne statystyki opisowe
Powyżej opisane statystyki liczbowe można przedstawić graficznie.
Prezentacja graficzna ma tę zaletę, że wyćwiczone oko potrafi szybko wiele dowiedzieć się z danych. 

Opisując zmienną ilościową mamy do wyboru różne sposoby prezentacji, w zależności od tego ile informacji chcemy przedstawić.

Przypuśćmy, że chcemy pokazać wyłącznie średnią. Jedną liczbę. Zrobimy to za pomocą wykresu słupkowego.
Wykres słupkowy można w programie R wyznaczyć funkcją `barplot()`.

```{r, warning=FALSE}
(srednia = mean(auta2012$Przebieg.w.km, na.rm=TRUE))
barplot(srednia)
```

Jeden słupek wygląda dziwnie, mało czytelnie. To dlatego, że wykres przedstawia jedną liczbę, trudno więc do czegoś się na nim odnieść.

Ciekawszy będzie wykres, przedstawiający więcej informacji. 
Powyżej pokazaliśmy wynik funkcji `summary()`, prezentujących sześć charakterystycznych informacji o rozkładzie (min, max, kwartyle i średnią).
Pięć z nich, za wyjątkiem średniej, przedstawia wykres pudełko-wąsy, który w R można wykonać używając funkcji `boxplot()`.

W poniższym przykładzie przedstawiamy te pięć liczb dla zmiennej `Przebieg.w.km`. Argument `horizontal=TRUE` powoduje, że wykres rysowany jest poziomo, argument `range = 0` powoduje, że nie są wyznaczane wartości odstające (a nie mówiliśmy co to za wartości, więc ich nie wyznaczajmy, wrócimy do tego tematu później).

```{r, warning=FALSE}
summary(auta2012$Przebieg.w.km)
boxplot(auta2012$Przebieg.w.km, 
        horizontal=TRUE, range = 0)
```

Co za dziwny wykres. Zazwyczaj wykresy pudełkowe wyglądają inaczej.
Co jest nie tak z tym? Spójrzmy na oś na wykresie, rozciąga się do 10^9 = 1 000 000 000 km. Najprawdopodobniej te duże wartości to błędu w danych. Mała jest szansa, że jakiekolwiek auto na świecie miało choćby zbliżony przebieg (gdyby jakieś auto jeździło non stop z prędkością 100 km na godzinę, to po 100 latach miałoby przebieg 8 000 000 km).

Dane bardzo często są zanieczyszczone a graficzne prezentacje pozwalają nam to łatwo zauważyć. 
Tak jest i w tym przypadku.
Oczyśćmy te dane, usuwając wszystkie wiersze, dla których cecha `Przebieg.w.km` przyjmuje wartości powyżej 1 000 000 km.
Takie czyszczenie możemy przeprowadzić używając funkcji `filter()` z pakietu `dplyr`.

```{r, warning=FALSE}
library(dplyr)
auta2012wybrane <- auta2012 %>% 
  filter(Przebieg.w.km < 1000000)

summary(auta2012wybrane$Przebieg.w.km)
```

Teraz możemy narysować wykres pudełko-wąsy dla oczyszczonych danych.

```{r, warning=FALSE}
boxplot(auta2012wybrane$Przebieg.w.km, horizontal=TRUE, range=0)
```

Każdy z elementów tego wykresu (lewy wąs, lewa część pudełka, prawa część pudełka, prawy wąs) przedstawia 1/4 danych.
Z wykresu tego możemy łatwo odczytać, że 3/4 danych dotyczy aut o przebiegu poniżej 200 tys km. Jedynie 1/4 danych ma wyższe wartości i dla tych aut rozpiętość jest bardzo duża.

Jeżeli chcemy zaprezentować bardziej szczegółowe dane o przebiegu, możemy wykorzystać histogram.
Słowo histogram pochodzi z języka greckiego, pochodzi ze złożenia słów histos i gramma. 
Pierwsze oznacza rzeczy stojące pionowo, drugie oznacza zapis. W sumie chodzi o przedstawienie danych z użyciem pionowych słupków.

Aby wykonać w programie R histogram, można wykorzystać funkcję `hist()`. Pierwszy argument określa dane, które mają być pokazane,
drugi argument określa na ile przedziałów ma być podzielony zakres zmienności. 
Histogram przedstawia liczbę samochodów, których przebieg jest w zakresie opisanym przez określone pudełko.

```{r, warning=FALSE}
hist(auta2012wybrane$Przebieg.w.km, 60, col="grey")
```

Histogram przedstawia znacznie więcej informacji niż wykres pudełko-wąsy. Im wyższy słupek, tym więcej było aut, o przebiegu w określonym przedziale.
Dwie najwyższe wyspy to ta w pobliżu 0 oraz ta w pobliży 180 tys km. 
Oznacza to, że w zbiorze danych jest jedna duża grupa aut o bardzo małym przebiegu, aut o przebiegu w okolicy 50 tys km jest mniej, aut o przebiegu w okolicy 150 tys km jest bardzo dużo a aut o przebiegu ponad 300 tys km jest już bardzo mało, pojedyncze sztuki.

Jak widzimy zmienną ilościowa możemy opisać z różnym poziomem szczegółowości. Im większa szczegółowość tym więcej elementów na wykresie. 
Im więcej elementów tym więcej możemy odczytać ale jest to też trudniejsze.

### Zadania:
+ Przedstaw graficznie za pomocą wykresu pudełko-wąsy oraz histogramu rozkład cechy `Cena.w.PLN`. 
+ Zwróć uwagę, że pojedyncze auta o bardzo wysokich cenach, powodują że wykres jest mało czytelny. Oczyść te dane, pozostawiają tylko auta o cenie poniżej 100 tys pln. Następnie przedstaw rozkład cen aut w segmencie aut do 100 tys pln.
+ Aut w jakiej cenie jest najwięcej wśród zebranych ogłoszeń?

### Odpowiedzi:
```{r, warning=FALSE}
library(dplyr)
auta2012wybrane <- auta2012 %>% 
  filter(Cena.w.PLN < 100000)

boxplot(auta2012wybrane$Cena.w.PLN, horizontal = TRUE, range = 0)
hist(auta2012wybrane$Cena.w.PLN, 50, col="grey")
```



# Cechy jakościowe
Przyjrzyjmy się teraz takim cechom jak `Waluta` lub `Marka`. Cechy te są opisane przez wartości z określonej listy możliwości.
Dla cechy `Waluta` lista możliwości to `r sort(levels(auta2012$Waluta))`.
Takie cechy określa się cechami jakościowymi w odróżnieniu od cech ilościowych.

## Statystyki opisowe
Dla cech jakościowych możemy wykonać kilka operacji.
Jedną z nich jest wyświetlenie listy możliwych wartości. Taką listę nazywa się często słownikiem (spisem możliwych wartości).

Listę możliwych wartości dla zmiennej jakościowej można wyznaczyć funkcją `levels()`.

```{r, warning=FALSE}
levels(auta2012$Waluta)
```

Zmienne jakościowe często opisuje się tablicą liczebności, a więc informacją ile razy wystąpiła każda z wartości ze słownika.
Tablicę liczebności można wyznaczyć funkcją `table()` lub `summary()`.

```{r, warning=FALSE}
table(auta2012$Waluta)
summary(auta2012$Waluta)
```

### Zadania:
+ Ile zmiennych w zbiorze danych `auta2012` to zmienne jakościowe? 
+ Zmienna `Liczba.drzwi` przyjmuje wartości `2/3` i `4/5`. Zachowuje się ona jako zmienna jakościowa. Jednak można uznać, że liczba drzwi to cecha ilościowa, ponieważ opisuje _ilość_ drzwi w samochodzie. Jak wyjaśnić tę dualność?

### Odpowiedzi:
+ `r names(which(sapply(auta2012, class) == "factor"))`
+ Pewne zmienne, w zależności od kontekstu, mogą być traktowane i analizowane jak zmienne ilościowe lub zmienne jakościowe. Do nas należy wybór, która z tych opcji jest właściwsza.

## Procenty

W pewnych sytuacjach, zamiast posługiwać się tablicą liczebności, wygodniej jest posługiwać się tabelą z procentami.
Ale jak te procenty policzyć?
Pokażemy to na przykładzie kilku funkcji. 

Funkcja `prop.table()` dzieli wartości tabeli liczebności przez sumę liczebności, a więc zamienia liczebności na frakcje.
Przypiszmy wynik funkcji `table()` do jakiejś zmiennej, np. o nazwie `tabela` (nazwa może być dowolna, musimy jej jednak konsekwentnie używać w dalszych przykładach).
Następnie tak otrzymaną tabelę liczebności zamieniamy na frakcje.

W poniższym przykładzie, instrukcję przypisania wyniku obejmujemy napisami, po to by jej wynik był wyświetlony. Bez nawiasów wynik funkcji `table()` nie zostałby wyświetlony.

```{r, warning=FALSE}
(tabela = table(auta2012$Waluta))
prop.table(tabela)
```

Zazwyczaj chcemy mieć wyznaczone procenty a nie frakcje. I to nie byle jakie procenty, ale procenty które są ładnie sformatowane, np. wyświetlone z dokładnością do jednego miejsca dziesiętnego po przecinku.
Aby zamienić frakcje na procenty, wystarczy je przemnożyć przez 100, a aby wynik przedstawić z dokładnością do jednego miejsca po przecinku wykorzystamy funkcję `round()`.

```{r, warning=FALSE}
(tabela = table(auta2012$Waluta))
(frakcje = prop.table(tabela))
procenty = 100*frakcje
round(procenty, digits = 1)
```

Ostatnim usprawnieniem tego procesu, które warto rozważyć to uporządkowanie wartości rosnąco lub malejąco.
Mając wiele możliwości, w gąszczu liczb czasem trudno nawet dostrzec, która jest największa. 
Posortowawszy te liczby łatwiej dostrzec najmniejsze i największe.
Do sortowania można wykorzystać funkcję `sort()`. Dodając argument `decreasing = TRUE` powodujemy, że wartości będą uporządkowane malejąco.

```{r, warning=FALSE}
zaokragloneProcenty = round(procenty,1)
sort(zaokragloneProcenty)
sort(zaokragloneProcenty, decreasing = TRUE)
```

### Zadania:
+ Cecha `Marka` opisuje markę samochodu. Sprawdź, która marka jest najpopularniejsza.
+ Cecha `Rodzaj.paliwa` opisuje rodzaj paliwa wykorzystywanego przez auto. Czy jest to benzyna, olej, gaz? Sprawdź jaki procent samochodów jest napędzana na benzynę.

### Odpowiedzi:
+ `r names(which.max(table(auta2012$Marka)))`
+ `r 100*prop.table(table(auta2012$Rodzaj.paliwa))["benzyna"]` %

## Graficzne statystyki opisowe

Tabele liczebności są proste w interpretacji. Podobnie jednak jak w innych przypadkach, graficzne przedstawienie tych liczb pozwala na łatwiejsze dostrzeżenie zależności pomiędzy danymi. Koniec końców w tabeli liczb łatwo pomylić się nawet gdy chodzi o liczbę cyfr w licznie. Na wykresie takie różnice natychmiast rzucają się w oczy.

Zazwyczaj tabele liczebności przedstawia się za pomocą wykresów słupkowych.
Można je wykonać np. funkcją `table()`.

```{r, warning=FALSE}
(tabela = table(auta2012$Waluta))
barplot(tabela)
```

Jeżeli chcemy, by słupki były przedstawiane poziomo, można dodać argument `horiz = TRUE`.

```{r, warning=FALSE}
barplot(tabela, horiz = TRUE)
```

Domyślnie wartości są uporządkowane alfabetycznie. Nie zawsze jednak taka kolejność ma sens.
W tym przypadku rozsądniej jest posortować dane malejąco.

```{r, warning=FALSE}
(posortowanaTabela = sort(tabela))
barplot(posortowanaTabela, horiz = TRUE)
```

### Zadania:
+ Przedstaw graficznie tabelę liczebności dla zmiennej `Kraj.pochodzenia`. Wypróbuj wykres pionowy i poziomy. Aby obrócić kierunek etykiet na osiach dodaj do funkcji `barplot()` argument `las=1`.

### Odpowiedzi:
```{r, warning=FALSE}
posortowanaTabela = sort(table(auta2012$Kraj.pochodzenia))
barplot(posortowanaTabela, horiz = TRUE, las=1)
```




# Cechy logiczne
Każdą zmienną można przedstawić jako zmienną jakościową lub ilościową. Ale w pewnych sytuacjach wygodnie jest wyróżnić bardziej szczegółową klasyfikację.
Cechy logiczne, to takie cechy, które przyjmować mogą tylko trzy wartości, prawdę (oznaczany w R przez `TRUE`), fałsz (oznaczany w R przez `FALSE`) oraz brak informacji (oznaczany w R przez `NA`).

Cechy logiczne mogą być traktowane jako cechy jakościowe o dwóch poziomach. 
Cechy takie można tworzyć używając tak zwanych warunków logicznych. Przykładem warunku logicznego są operatory `>` (większy), `>=` (większy równy), `==` (równy), `<=` (mniejszy równy), `<` (mniejszy). 

## Statystyki opisowe

Traktując zmienną logiczną jak dwuwartościową zmienną jakościową, możemy używać na niej np. funkcji do tabel liczebności.

```{r, warning=FALSE}
pochodziZPolski = auta2012$Kraj.aktualnej.rejestracji == "Polska"
table(pochodziZPolski)

starszyNiz5Lat = auta2012$Rok.produkcji < 2007
table(starszyNiz5Lat)
```

### Zadania:
+ Sprawdź ile samochodów ma cenę ofertową poniżej 2 000 pln.
+ Sprawdź jaki procent samochodów ma silniki o pojemności ponad 1500 cm3.

### Odpowiedzi:
+ `r sum(auta2012$Cena.w.PLN < 2000, na.rm=TRUE)`
+ `r mean(auta2012$Pojemnosc.skokowa > 1500, na.rm=TRUE)`

## Logiczne 'i' oraz logiczne 'lub'

Cechy logiczne można przetwarzać używając również operatorów logicznych, w tym logicznego lub `|` oraz logicznego i `&`.

```{r, warning=FALSE}
pochodziZPolski = auta2012$Kraj.aktualnej.rejestracji == "Polska"
starszyNiz5Lat = auta2012$Rok.produkcji < 2007
pochodziZPolskiIStarszyNiz5Lat = pochodziZPolski & starszyNiz5Lat
table(pochodziZPolskiIStarszyNiz5Lat)
```

### Zadania:
+ Sprawdź ile samochodów zarejestrowanych w Polsce ma cenę ofertową poniżej 2 000 pln.
+ Sprawdź jaki procent samochodów ma silniki o pojemności ponad 1500 cm3 oraz jest napędzanych olejem napędowym.

### Odpowiedzi:
+ `r sum(auta2012$Cena.w.PLN < 2000 & auta2012$Kraj.aktualnej.rejestracji == "Polska", na.rm=TRUE)`
+ `r mean(auta2012$Pojemnosc.skokowa > 1500 & auta2012$Rodzaj.paliwa == 'olej napedowy (diesel)', na.rm=TRUE)`


# Cechy napisowe
Funkcja `read.table()` wczytując tekst zamienia go na zmienną jakościową. W pewnych sytuacjach chcemy jednak na napisach wykonywać specjalne operacje. Takie np. jak wyszukiwanie podciągu w tekście. 

Aby to zrobić, musimy w pierwszej kolejności zamienić zmienna jakościową na zmienną napisową. Konwersję cechy z cechy jakościowej na cechę napisową można wykonać funkcją `as.character()`

```{r, warning=FALSE}
auta2012$Wyposazenie.dodatkowe.napis = as.character(auta2012$Wyposazenie.dodatkowe)
summary(auta2012$Wyposazenie.dodatkowe.napis)
```

## Statystyki opisowe

Jedną z interesujących operacji na napisach, jest sprawdzenie, czy zawierają one określony podciąg znaków. 
Taki test można wykonać funkcją `grepl()`, która jako wynik zwraca wartość logiczną określającą czy napis zawiera określony wzorzec czy nie.

```{r, warning=FALSE}
maKlimatyzacje = grepl(auta2012$Wyposazenie.dodatkowe.napis, pattern="klimatyzacja")
table(maKlimatyzacje)

auta2012$Informacje.dodatkowe.napis = as.character(auta2012$Informacje.dodatkowe)
bezwypadkowy = grepl(auta2012$Informacje.dodatkowe.napis, pattern="bezwypadkowy")
table(bezwypadkowy)
```

### Zadania:
+ Sprawdź ile samochodów ma zainstalowany autoalarm
+ Sprawdź ile samochodów ma lakier w metalicznym kolorze

### Odpowiedzi:
+ `r sum(grepl(auta2012$Wyposazenie.dodatkowe.napis, pattern="autoalarm"))`
+ `r sum(grepl(as.character(auta2012$Kolor), pattern="metallic"))`


