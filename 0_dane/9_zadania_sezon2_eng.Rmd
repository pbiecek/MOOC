---
title: "Tasks and responses "
author: "Data CruncheRs"
date: "sezon 0 / episode 0 <br><br> All rights reserved.<br> Any use requires author’s consent.  <br><br><br><br>Press `A` to convert slides into a continuous text. <br> Press `T` to display table of contents."
output:
  slidy_presentation:
    includes:
      in_header: ../tracking.html
    highlight: default
    css: ../style.css
    font_adjustment: 0
    footer: "Data CruncheRs / wizualizacja / zadania i odpowiedzi"
---

# Task, season 2, episode 2

+ Present graphically with an XY Plot the dependence between lifetime ( `zywotnosc`column) and weight of the animal ( `waga`column).

+ Mark with the point colour or shape the information if a bird or a cat is presented. What are differences between the lifetime and weight of cats and birds?

+  Use labels to read which bird or cat live the longest

+ Using the ribbon geometry (`geom_ribbon`) present the minimum and maximum price of each day on the basis of data from the  `WIG` set.


# Response, season 2, episode 2

```{r, message=FALSE, eval=FALSE}
library(PogromcyDanych)
library(ggplot2)

# Display graphically with a scatterplot the relationship between animal's
# vitality (column 'zywotnosc') and weight (column 'waga').
ggplot(koty_ptaki, aes(x = waga, y=zywotnosc)) + 
  geom_point()

# Mark with a point color or shape whether the plotted animal is a bird or a
# cat. Are there differences in vitality or weight between birds and cats?
ggplot(koty_ptaki, aes(x = waga, y=zywotnosc, color=druzyna, shape=druzyna)) + 
  geom_point()

# Use labels to determine which bird and which cat live the longest
ggplot(koty_ptaki, aes(x = waga, y=zywotnosc, color=druzyna, shape=druzyna, label=gatunek)) + 
  geom_text()

# Using the ribbon geom visualize daily minimal an maximal rates using data
# from data frame `WIG`.
ggplot(WIG, aes(x = Data, ymin=Kurs.minimalny, ymax=Kurs.maksymalny)) + 
  geom_ribbon()

```

---

# Task, season 2, episode 3

+ Select Volkswagen make cars, Passat model and then draw how the average market price depends on the year of production using geometry  `geom_smooth()`.

+ Select Volkswagen make cars and draw how the average price depends on the year of production, present various Volkswagen models with different colours.

+ Select five-year old Volkswagen make cars and with a frame – moustache graph select how the car price depends on the model.

+ For selected Volkswagen make cars present the cars with diesel engines by model. 

# Response, season 2, episode 3

```{r, message=FALSE, eval=FALSE}
# Select cars of brand Volkswagen and model Passat, and visualize how the mean
# price depends on year of production using the smooth geom `geom_smooth()`

passat <- auta2012 %>%
              filter(Marka == 'Volkswagen', Model == 'Passat', Rok.produkcji > 1990) %>%
              select(Marka, Model, Rok.produkcji, Cena.w.PLN, Rodzaj.paliwa)

ggplot(passat, aes(x=Rok.produkcji, y=Cena.w.PLN)) + 
  geom_smooth()

# Select cars of brand Volkswagen and visualize how the mean price depends on
# mileage. Use different colors to mark different Volkswagen models.

volkswagen <- auta2012 %>%
              filter(Marka == 'Volkswagen', Model %in% c('Passat', 'Golf', 'Polo', 'Sharan'), Rok.produkcji > 1990, Rok.produkcji < 2012) %>%
              select(Marka, Model, Rok.produkcji, Cena.w.PLN, Rodzaj.paliwa)

ggplot(volkswagen, aes(x=Rok.produkcji, y=Cena.w.PLN, color=Model)) + 
  geom_smooth()

# Select 5-year Volkswagen cars and use a boxplot visualize how the car price
# depends on the car model.

volkswagen <- auta2012 %>%
              filter(Marka == 'Volkswagen', Rok.produkcji == 2007, Model %in% c('Passat', 'Golf', 'Polo', 'Sharan')) %>%
              select(Marka, Model, Rok.produkcji, Cena.w.PLN, Rodzaj.paliwa)

ggplot(volkswagen, aes(x=Model, y=Cena.w.PLN)) + 
  geom_boxplot()

# Using the subset selected earlier (5-year Volkswagens) visualize, breaking it
# down by car model, what proportion of cars has a diesel engine.

ggplot(volkswagen, aes(x=Model, fill=Rodzaj.paliwa)) + 
  geom_bar(position = 'fill')

```

# Task, season 2, episode 4

+ Like in the previous episode, select Volkswagen make cars, Passat model and draw how the average price depend on the year of production with geometry  `geom_smooth()`. Then check what the graph will look like with the motives: `theme_bw()`, `theme_excel()` and `theme_economist()`.

+ Modify the graph below, changing the scale of colours from green to red, replace dots with squares and add a title to the graph (and appropriate axis labels).

```{r, eval=FALSE}
ggplot(koty_ptaki, aes(x=waga, y=predkosc, size=zywotnosc, color=zywotnosc)) +
  geom_point() 
```

# Responses, season 2, episode 4

```{r, message=FALSE, eval=FALSE}
# As in the previous episode, select Volkswagen cars Passat model and visualize
# how the mean price depends on year of production using the smooth geom
# `geom_smooth()`. Next, experiment how the plot will look like using different
# themes `theme_bw()`, `theme_excel()`, `theme_economist()`.

passat <- auta2012 %>%
              filter(Marka == 'Volkswagen', Model == 'Passat', Rok.produkcji > 1990) %>%
              select(Marka, Model, Rok.produkcji, Cena.w.PLN, Rodzaj.paliwa)

pl <- ggplot(passat, aes(x=Rok.produkcji, y=Cena.w.PLN)) + 
  geom_smooth()

library(ggthemes)
pl + theme_bw() + ggtitle("theme_bw")
pl + theme_excel() + ggtitle("theme_excel")
pl + theme_minimal() + ggtitle("theme_minimal")
pl + theme_economist() + ggtitle("theme_economist")

# Adjust the plot-producing code below by changing the color scale to a
# green-to-red scale, changing points shapes to squares, and adding a plot title
# and axis labels.
# ggplot(koty_ptaki, aes(x=waga, y=predkosc, size=zywotnosc, color=zywotnosc)) +
#    geom_point() 

ggplot(koty_ptaki, aes(x=waga, y=predkosc, size=zywotnosc, color=zywotnosc)) +
    geom_point(shape=18) +  
  scale_color_gradient(high = "green3", low = "red3") +
  ggtitle("Zielone latające kwadraty") + xlab("Waga [kg]") + ylab("Prędkość [km/h]")
```

# Task, season 2, episode 12

- Select the serial *Friday Night Lights* and see how popular it is. Is it more popular than *Breaking Bad*?

- See how the popularity of the serial was changing over time. Have you noted anything interesting?

- Instead of presenting information on opinions of episodes, present information on the number of votes cast (popularity) of episodes. Can those statistics also be used to present information on opinions and the number of votes?

# Response, season 2, episode 12

```{r, message=FALSE, eval=FALSE}
# Select the *Friday Night Lights* series and check its popularity. Is it more
# popular than *Breaking Bad*?

FNL <- filter(serialeIMDB, serial == "Friday Night Lights")
summary(FNL$glosow)
BB <- filter(serialeIMDB, serial == "Breaking Bad")
summary(BB$glosow)

# Visualize how popularity of *Friday Night Lights* was chaning in time. Do you
# see any interesting patterns?

plot(FNL$glosow)
```

# Task, season 2, episode 13

* Find a serial with a fastest upward trend in opinions (since the opinions are capped to 10, this may not be the serial with the highest average opinion)

* Find a serial with a fastest downward trend. 

# Response, season 2, episode 13

```{r, message=FALSE, eval=FALSE}
# Find a TV show with the steepest increasing trend in ratings.
# (because the ratings cannot be larger than 10 it does not have to be a show with the highest mean rating)

# Find a TV show with the steepest decreasing trend in ratings.

nazwy_seriali <- levels(serialeIMDB$serial)
wspolczynnikTrendu <- c()

for (ser in nazwy_seriali) {
  jedenSerial <- serialeIMDB %>%
    filter(serial == ser) %>% 
    select(id, ocena)
  wspolczynnikTrendu[ser] <- lm(ocena~id, jedenSerial)$coef[2]
}
# steepest declines first, increases second
sort(wspolczynnikTrendu)

```


# Task, season 2, episode 14

* Find a serial with a material negative trend being the one where opinions deteriorate.

* Find a serial (other than Breaking Bad) with a material positive trend. 

* [Difficult] Calculate for how many serials the opinions have been growing and for how many they have been decreasing and how the increases or decreases are materially different than those that are accidental.

# Response, season 2, episode 14

```{r, message=FALSE, eval=FALSE}
# Znajdź serial o istotnym ujemnem trendzie, to znaczy takim, którego oceny maleją.

# Znajdź serial (inny niż _Breaking Bad_) o istotnie dodatnim trendzie. 

# Rozwiązanie: Jak w zadaniu 13, plus testowanie istotności dla skrajnych wartości
# uwaga, może się długo liczyć!!!

```

# Tasks, season 2, episode 15

+ For each height of a parent from the data set galton specify by how much children are shorter than parents on the average.

+ With the determined b0 and b1 parameters, calculate the assessment of child’s average height for each average parent height.

+ Show differences between assessment from the linear model and average values calculated separately for each parent group.

+  The `PogromcyDanych` packet also provides a data set  `pearson` collected by Pearson. The data set contains the height of fathers and sons.

For that data set, develop a linear regression model and draw a set of data with the linear regression curve.

Are the linear regression parameters in the pearson set (with father’s height) different than the parameters in the galton set (with the average parents’ height)?

# Responses, season 2, episode 15

```{r, warning=FALSE, width=8, height=8, eval=FALSE}
# Dla każdego wzrostu rodzica ze zbioru danych `galton` wyznacz 
# o ile średnio niższe są dzieci od rodziców
# wykorzystując funkcje z pakietu dplyr
srednie %>%
  mutate(roznica = srednia - rodzic)

# Mając wyznaczone parametry _b0_ i _b1_ policz oceny średniego wzrostu 
# dziecka dla każdego średniego wzrostu rodzica
wspolczynniki = coef(lm(syn~rodzic, data=galton)
wspolczynniki

# Wyznacz różnice pomiędzy ocenami z modelu liniowego 
# a średnimi liczonymi osobno dla każdej grupy rodziców
srednie %>%
  mutate(m.liniowy = wspolczynniki[1] + rodzic*wspolczynniki[2],
         roznica = srednia - m.liniowy)
```


# Tasks, season 2, episode 17

+ Perform modelling with the use of multiplicative model for another make. 

+ If the multiplicative model seems justified, calculate how many percent is a car of a specific make losing annually in the price.

+ See the relationship between the price and the age for other makes. 

+ Make a model with a broken regression for other makes.

# Responses, season 2, episode 17
 
```{r, warning=FALSE, fig.width=4, fig.height=4, eval=FALSE}
toyota <- auta2012 %>%
  filter(Marka == "Toyota") %>%
  mutate(Wiek = 2012 - Rok.produkcji) %>%
  filter(Wiek < 20)

lm(Cena.w.PLN ~ Wiek, data=toyota)$coef

ggplot(toyota, aes(y=Cena.w.PLN, x = Wiek)) + 
  geom_point() + 
  geom_smooth(method="lm", col="red", size=2) +
  ylim(0,400000)


marki <- names(head(rev(sort(table(auta2012$Marka))),10))
invisible(sapply(marki, function(marka) {
  wybranamarka <- auta2012 %>%
    filter(Marka == marka) %>%
    mutate(Wiek = 2012 - Rok.produkcji) %>%
    filter(Wiek < 20,
           Przebieg.w.km < 400000) %>%
    mutate(Wiek0 = ifelse(Wiek >= 0, Wiek, 0),
         Wiek5 = ifelse(Wiek >= 5, Wiek - 5, 0))
  
    M1 = lm(Przebieg.w.km ~ Wiek0 + Wiek5, data=wybranamarka)
    M2 = lm(Przebieg.w.km ~ Wiek0 + Wiek5 - 1, data=wybranamarka)
    
    topred = data.frame(Wiek0 = c(0,5,20), Wiek5 = c(0, 0, 15))
    topred$M1 = predict(M1, newdata = topred)
    topred$M2 = predict(M2, newdata = topred)
    
    plot(ggplot(wybranamarka, aes(y=Przebieg.w.km, x = Wiek)) + 
      geom_point() + 
      geom_smooth(method="lm", col="red", size=2) +
      geom_line(data= topred, aes(y=M1, x = Wiek0), size=2, col="green") + 
      geom_line(data= topred, aes(y=M2, x = Wiek0), size=2, col="blue") +
    ggtitle(marka))
  
} ))


marki <- names(head(rev(sort(table(auta2012$Marka))),10))
sapply(marki, function(marka) {
  wybranamarka <- auta2012 %>%
    filter(Marka == marka) %>%
    mutate(Wiek = 2012 - Rok.produkcji) %>%
    filter(Wiek < 20) %>%
    mutate(logCena.w.PLN = log10(Cena.w.PLN))
  
  plot(ggplot(wybranamarka, aes(y=Cena.w.PLN, x = Wiek)) + 
    geom_point() + 
    geom_smooth(method="lm", col="red", size=2) +
    ggtitle(marka) + scale_y_continuous(trans="log10"))
  
  wsp <- lm(logCena.w.PLN ~ Wiek, data=wybranamarka)$coef
  procent <- 1- 10^(wsp[2])
  round(100*procent,1)
} )
```

# Tasks, season 2, episode 18

+ In the `diagnoza` wiek data set, the respondent’s age is in the variable called  `wiek2013`. Determine the relationship between the age split into two groups – below and under 30, and response to the question what is important in life.

+ The `TCGA_BRCA` data set, in the second column contains patient’s gender. Determine the relationship between the variable  `plec` and `czy.zyje`. test the relationship with the Fisher test.

In the `TCGA_BRCA` data set, verify if there is and what type of relationship between  

+ experience (column  `czy.zyje` and mutations `TP53`),
+ gender and mutations  `TP53`,
+ gender and variable  `czy.zyje`.

Present the relationship in a table with numbers and frequencies.

# Tasks, season 2, episode 19

```{r, eval=FALSE}
table(TCGA_BRCA$czy.zyje,
      TCGA_BRCA$TP53)
prop.table(table(TCGA_BRCA$czy.zyje,
      TCGA_BRCA$TP53), 2)
```


