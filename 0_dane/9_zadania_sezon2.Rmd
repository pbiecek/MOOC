---
title: "Zadania i odpowiedzi"
author: "pogRomcy danych"
date: "sezon 0 / odcinek 0 <br><br> <a href='http://biecek.pl/'>Przemysław Biecek @ Uniwersytet Warszawski</a><br><br><br>Naciśnij `A` by zamienić slajdy na ciągły tekst. <br> Naciśnij `T` by wyświetlić spis treści."
output:
  slidy_presentation:
    includes:
      in_header: ../tracking.html
    highlight: default
    css: ../style.css
    font_adjustment: 0
    footer: "pogRomcy danych / wizualizacja / zadania i odpowiedzi"
---

# Zadanie, sezon 2, odcinek 2

+ Przedstaw graficznie za pomocą wykresu punktowego zależność pomiędzy żywotnością (kolumna `zywotnosc`) a wagą zwierzęcia (kolumna `waga`).

+ Zaznacz kolorem lub kształtem punktu informację czy przedstawiany jest ptak czy kot. Czy są różnice pomiędzy żywotnością a wagą dla kotów i ptaków?

+  Użyj etykiet by odczytać który ptak i który kot żyją najdłużej

+ Używając geometrii wstęga (`geom_ribbon`) przedstaw kurs minimalny i maksymalny każdego dnia na podstawie danych ze zbioru `WIG`.


# Odpowiedź, sezon 2, odcinek 2

```{r, message=FALSE, eval=FALSE}
library(PogromcyDanych)
library(ggplot2)

# Przedstaw graficznie za pomocą wykresu punktowego zależność pomiędzy 
# żywotnością (kolumna `zywotnosc`) a wagą zwierzęcia (kolumna `waga`).
ggplot(koty_ptaki, aes(x = waga, y=zywotnosc)) + 
  geom_point()

# Zaznacz kolorem lub kształtem punktu informację czy przedstawiany 
# jest ptak czy kot. Czy są różnice pomiędzy żywotnością a wagą dla 
# kotów i ptaków?
ggplot(koty_ptaki, aes(x = waga, y=zywotnosc, color=druzyna, shape=druzyna)) + 
  geom_point()

# Użyj etykiet by odczytać który ptak i który kot żyją najdłużej
ggplot(koty_ptaki, aes(x = waga, y=zywotnosc, color=druzyna, shape=druzyna, label=gatunek)) + 
  geom_text()

# Używając geometrii wstęga (`geom_ribbon`) przedstaw kurs minimalny 
# i maksymalny każdego dnia na podstawie danych ze zbioru `WIG`.
ggplot(WIG, aes(x = Data, ymin=Kurs.minimalny, ymax=Kurs.maksymalny)) + 
  geom_ribbon()

```

---

# Zadanie, sezon 2, odcinek 3

+ Wybierz samochody marki Volkswagen model Passat a następnie narysuj jak średnia cena zależy od roku produkcji za pomocą geometrii `geom_smooth()`.

+ Wybierz samochody marki Volkswagen, narysuj jak średnia cena zależy od roku produkcji, różnymi kolorami przedstaw różne modele Volkswagena.

+ Wybierz pięcioletnie auta marki Volkswagen i za pomocą wykresu ramka - wąsy przedstaw jak cena auta zależy od modelu.

+ Dla wybranych pięcioletnich aut marki Volkswagen przedstaw w podziale na modele jaka część aut ma silnik diesla.

# Odpowiedź, sezon 2, odcinek 3

```{r, message=FALSE, eval=FALSE}
# Wybierz samochody marki Volkswagen model Passat a następnie narysuj 
# jak średnia cena zależy od roku produkcji za pomocą geometrii `geom_smooth()`.

passat <- auta2012 %>%
              filter(Marka == 'Volkswagen', Model == 'Passat', Rok.produkcji > 1990) %>%
              select(Marka, Model, Rok.produkcji, Cena.w.PLN, Rodzaj.paliwa)

ggplot(passat, aes(x=Rok.produkcji, y=Cena.w.PLN)) + 
  geom_smooth()

# Wybierz samochody marki Volkswagen, narysuj jak średnia cena zależy 
# od przebiegu, różnymi kolorami przedstaw różne modele Volkswagena.

volkswagen <- auta2012 %>%
              filter(Marka == 'Volkswagen', Model %in% c('Passat', 'Golf', 'Polo', 'Sharan'), Rok.produkcji > 1990, Rok.produkcji < 2012) %>%
              select(Marka, Model, Rok.produkcji, Cena.w.PLN, Rodzaj.paliwa)

ggplot(volkswagen, aes(x=Rok.produkcji, y=Cena.w.PLN, color=Model)) + 
  geom_smooth()

# Wybierz pięcioletnie auta marki Volkswagen i za pomocą wykresu 
# ramka - wąsy przedstaw jak cena auta zależy od modelu.

volkswagen <- auta2012 %>%
              filter(Marka == 'Volkswagen', Rok.produkcji == 2007, Model %in% c('Passat', 'Golf', 'Polo', 'Sharan')) %>%
              select(Marka, Model, Rok.produkcji, Cena.w.PLN, Rodzaj.paliwa)

ggplot(volkswagen, aes(x=Model, y=Cena.w.PLN)) + 
  geom_boxplot()

# Dla wybranych pięcioletnich aut marki Volkswagen przedstaw w podziale 
# na modele jaka część aut ma silnik diesla.

ggplot(volkswagen, aes(x=Model, fill=Rodzaj.paliwa)) + 
  geom_bar(position = 'fill')

```

# Zadanie, sezon 2, odcinek 4

+ Podobnie jak w poprzednim odcinku, wybierz samochody marki Volkswagen model Passat a następnie narysuj jak średnia cena zależy od roku produkcji za pomocą geometrii `geom_smooth()`. Następnie zobacz jak ten wykres będzie wyglądał z motywami `theme_bw()`, `theme_excel()` i `theme_economist()`.

+ Zmień poniższy wykres, zamieniając skalę kolorów na od zielonego do czerwonego, kropki zamień na kwadraty a do wykresu dodaj tytuł (i odpowiednie etykiety osi).

```{r, eval=FALSE}
ggplot(koty_ptaki, aes(x=waga, y=predkosc, size=zywotnosc, color=zywotnosc)) +
  geom_point() 
```

# Odpowiedzi, sezon 2, odcinek 4

```{r, message=FALSE, eval=FALSE}
# Podobnie jak w poprzednim odcinku, wybierz samochody marki Volkswagen model 
# Passat a następnie narysuj jak średnia cena zależy od roku produkcji za pomocą
# geometrii `geom_smooth()`. Następnie zobacz jak ten wykres będzie wyglądał 
# z motywami `theme_bw()`, `theme_excel()` i `theme_economist()`.

passat <- auta2012 %>%
              filter(Marka == 'Volkswagen', Model == 'Passat', Rok.produkcji > 1990) %>%
              select(Marka, Model, Rok.produkcji, Cena.w.PLN, Rodzaj.paliwa)

pl <- ggplot(passat, aes(x=Rok.produkcji, y=Cena.w.PLN)) + 
  geom_smooth()

library(ggthemes)
pl + theme_bw() + ggtitle("theme_bw")
pl + theme_excel() + ggtitle("theme_excel")
pl + theme_minimal() + ggtitle("theme_minimal")
pl + theme_economist() + ggtitle("theme_economist")


# Zmień poniższy wykres, zamieniając skalę kolorów na od zielonego do czerwonego,
# kropki zamień na kwadraty a do wykresu dodaj tytuł (i odpowiednie etykiety osi).
# ggplot(koty_ptaki, aes(x=waga, y=predkosc, size=zywotnosc, color=zywotnosc)) +
#    geom_point() 

ggplot(koty_ptaki, aes(x=waga, y=predkosc, size=zywotnosc, color=zywotnosc)) +
    geom_point(shape=18) +  
  scale_color_gradient(high = "green3", low = "red3") +
  ggtitle("Zielone latające kwadraty") + xlab("Waga [kg]") + ylab("Prędkość [km/h]")
```

# Zadanie, sezon 2, odcinek 12

- Wybierz serial *Friday Night Lights* zobacz jak wygląda popularność tego serialu. Czy jest bardziej popularny niż *Breaking Bad*?

- Zobacz jak popularność tego serialu zmieniała się w czasie. Czy zaobserwowałeś coś interesującego?

- Zamiast prezentować informacje o ocenach odcinków przedstaw informacje o liczbie oddanych głosów (popularności) odcinków. Czy te same statystyki nadają się równie dobrze do prezentacji informacji o ocenie i o liczbie głosów?

# Odpowiedź, sezon 2, odcinek 12

```{r, message=FALSE, eval=FALSE}
# Wybierz serial *Friday Night Lights* zobacz jak wygląda popularność tego serialu. 
# Czy jest bardziej popularny niż *Breaking Bad*?

FNL <- filter(serialeIMDB, serial == "Friday Night Lights")
summary(FNL$glosow)
BB <- filter(serialeIMDB, serial == "Breaking Bad")
summary(BB$glosow)

# Zobacz jak popularność tego serialu zmieniała się w czasie. 
# Czy zaobserwowałeś coś interesującego?

plot(FNL$glosow)
```

# Zadanie, sezon 2, odcinek 13

* Znajdź serial o najsilniej rosnącym trendzie dotyczącym ocen (ponieważ oceny są ograniczone z góry przez 10 to może nie być serial o najwyższej średniej ocenie)

* Znajdź serial o najsilniejszym trendzie spadkowym

# Odpowiedź, sezon 2, odcinek 13

```{r, message=FALSE, eval=FALSE}
# Znajdź serial o najsilniej rosnącym trendzie dotyczącym ocen 
# (ponieważ oceny są ograniczone z góry przez 10 to może nie być serial o najwyższej średniej ocenie)

# Znajdź serial o najsilniejszym trendzie spadkowym

nazwy_seriali <- levels(serialeIMDB$serial)
wspolczynnikTrendu <- c()

for (ser in nazwy_seriali) {
  jedenSerial <- serialeIMDB %>%
    filter(serial == ser) %>% 
    select(id, ocena)
  wspolczynnikTrendu[ser] <- lm(ocena~id, jedenSerial)$coef[2]
}
# na początku najsilniejsze spadki, na koniec wzrosty
sort(wspolczynnikTrendu)

```


# Zadanie, sezon 2, odcinek 14

* Znajdź serial o istotnym ujemnem trendem, to znaczy takim, którego oceny maleją.

* Znajdź serial (inny niż _Breaking Bad_) o istotnie dodatnim trendzie. 

* [Trudne] Policz dla ilu serialu ich oceny rosną a dla ilu maleją i te wzrosty lub spadki są istotnie większe niż wynikające z przypadku.

# Odpowiedź, sezon 2, odcinek 14

```{r, message=FALSE, eval=FALSE}
# Znajdź serial o istotnym ujemnem trendzie, to znaczy takim, którego oceny maleją.

# Znajdź serial (inny niż _Breaking Bad_) o istotnie dodatnim trendzie. 

# Rozwiązanie: Jak w zadaniu 13, plus testowanie istotności dla skrajnych wartości
# uwaga, może się długo liczyć!!!

```

# Zadania, sezon 2, odcinek 15

+ Dla każdego wzrostu rodzica ze zbioru danych `galton` wyznacz o ile średnio niższe są dzieci od rodziców.

+ Mając wyznaczone parametry _b0_ i _b1_ policz oceny średniego wzrostu dziecka dla każdego średniego wzrostu rodzica.

+ Wyznacz różnice pomiędzy ocenami z modelu liniowego a średnimi liczonymi osobno dla każdej grupy rodziców.

+  W pakiecie `PogromcyDanych` udostępniony jest również zbiór danych `pearson` zebrany przez Pearsona. W tym zbiorze danych zebrane są wzrosty ojców i synów.

Dla tego zbioru danych wyznacz model regresji liniowej oraz narysuj zbiór danych z zaznaczoną krzywą regresji liniowej.

Czy parametry regresji liniowej w zbiorze pearsona (z wysokością ojca) różnią się od parametrów ze zbioru galtona (ze średnią wysokością rodziców)?

# Odpowiedzi, sezon 2, odcinek 15

```{r, warning=FALSE, width=8, height=8, eval=FALSE}
# Dla każdego wzrostu rodzica ze zbioru danych `galton` wyznacz 
# o ile średnio niższe są dzieci od rodziców
# wykorzystując funkcje z pakietu dplyr
srednie %>%
  mutate(roznica = srednia - rodzic)

# Mając wyznaczone parametry _b0_ i _b1_ policz oceny średniego wzrostu 
# dziecka dla każdego średniego wzrostu rodzica
wspolczynniki = coef(lm(syn~rodzic, data=galton)
wspolczynniki

# Wyznacz różnice pomiędzy ocenami z modelu liniowego 
# a średnimi liczonymi osobno dla każdej grupy rodziców
srednie %>%
  mutate(m.liniowy = wspolczynniki[1] + rodzic*wspolczynniki[2],
         roznica = srednia - m.liniowy)
```


# Zadania, sezon 2, odcinek 17

+ Wykonaj modelowanie z użyciem modelu multiplikatywnego dla innej marki. 

+ Jeżeli model multiplikatywny wygląda na uzasadniony, policz ile procent corocznie traci na cenie auto danej marki.

+ Zobacz jak wygląda zależność pomiędzy ceną a wiekiem dla innych marek. 

+ Wykonaj modelowanie z użyciem łamanej regresji dla innych marek.

# Odpowiedzi, sezon 2, odcinek 17
 
```{r, warning=FALSE, fig.width=4, fig.height=4, eval=FALSE}
toyota <- auta2012 %>%
  filter(Marka == "Toyota") %>%
  mutate(Wiek = 2012 - Rok.produkcji) %>%
  filter(Wiek < 20)

lm(Cena.w.PLN ~ Wiek, data=toyota)$coef

ggplot(toyota, aes(y=Cena.w.PLN, x = Wiek)) + 
  geom_point() + 
  geom_smooth(method="lm", col="red", size=2) +
  ylim(0,400000)


marki <- names(head(rev(sort(table(auta2012$Marka))),10))
invisible(sapply(marki, function(marka) {
  wybranamarka <- auta2012 %>%
    filter(Marka == marka) %>%
    mutate(Wiek = 2012 - Rok.produkcji) %>%
    filter(Wiek < 20,
           Przebieg.w.km < 400000) %>%
    mutate(Wiek0 = ifelse(Wiek >= 0, Wiek, 0),
         Wiek5 = ifelse(Wiek >= 5, Wiek - 5, 0))
  
    M1 = lm(Przebieg.w.km ~ Wiek0 + Wiek5, data=wybranamarka)
    M2 = lm(Przebieg.w.km ~ Wiek0 + Wiek5 - 1, data=wybranamarka)
    
    topred = data.frame(Wiek0 = c(0,5,20), Wiek5 = c(0, 0, 15))
    topred$M1 = predict(M1, newdata = topred)
    topred$M2 = predict(M2, newdata = topred)
    
    plot(ggplot(wybranamarka, aes(y=Przebieg.w.km, x = Wiek)) + 
      geom_point() + 
      geom_smooth(method="lm", col="red", size=2) +
      geom_line(data= topred, aes(y=M1, x = Wiek0), size=2, col="green") + 
      geom_line(data= topred, aes(y=M2, x = Wiek0), size=2, col="blue") +
    ggtitle(marka))
  
} ))


marki <- names(head(rev(sort(table(auta2012$Marka))),10))
sapply(marki, function(marka) {
  wybranamarka <- auta2012 %>%
    filter(Marka == marka) %>%
    mutate(Wiek = 2012 - Rok.produkcji) %>%
    filter(Wiek < 20) %>%
    mutate(logCena.w.PLN = log10(Cena.w.PLN))
  
  plot(ggplot(wybranamarka, aes(y=Cena.w.PLN, x = Wiek)) + 
    geom_point() + 
    geom_smooth(method="lm", col="red", size=2) +
    ggtitle(marka) + scale_y_continuous(trans="log10"))
  
  wsp <- lm(logCena.w.PLN ~ Wiek, data=wybranamarka)$coef
  procent <- 1- 10^(wsp[2])
  round(100*procent,1)
} )
```

# Zadania, sezon 2, odcinek 18

+ W zbiorze danych `diagnoza` wiek respondenta jest w zmiennej o nazwie `wiek2013`. Wyznacz zależność pomiędzy wiekiem podzielonym na dwie grupy, poniżej i powyżej 30 roku życia, a odpowiedziami na pytanie o to co w życiu ważne.

+ W zbiorze danych `TCGA_BRCA` w drugiej kolumnie jest płeć pacjenta. Wyznacz zależność pomiędzy zmiennymi `plec` a `czy.zyje`. Przetestuj tą zależność testem Fishera.

W zbiorze danych `TCGA_BRCA` zbadaj czy jest i jaka jest zależność pomiędzy 

+ przeżyciami (kolumna `czy.zyje` a mutacjami `TP53`),
+ płcią a mutacjami `TP53`,
+ płcią a zmienną `czy.zyje`.

Zależność przedstaw za pomocą tabeli z liczebnościami oraz częstościami.

# Zadania, sezon 2, odcinek 19

```{r, eval=FALSE}
table(TCGA_BRCA$czy.zyje,
      TCGA_BRCA$TP53)
prop.table(table(TCGA_BRCA$czy.zyje,
      TCGA_BRCA$TP53), 2)
```


