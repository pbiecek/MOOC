---
title: "Daty"
author: "pogRomcy danych"
date: "sezon 1 / odcinek 15 <br><br> <a href='http://biecek.pl/'>Przemysław Biecek @ Uniwersytet Warszawski</a><br><br><br>Naciśnij `A` by zamienić slajdy na ciągły tekst. <br> Naciśnij `T` by wyświetlić spis treści."
output:
  slidy_presentation:
    includes:
      in_header: ../tracking.html
    highlight: default
    css: ../style.css
    font_adjustment: 0
    footer: "pogRomcy danych / przetwarzanie / daty"

---

# O czym jest ten odcinek

Analizując dane spotkamy się z różnymi rodzajami zmiennych. Często spotykanym typem okazują się zmienne związane z datami i czasem.

W tym odcinku nauczymy się:

- jak tworzyć w programie R obiekty opisujące daty i czasy,
- jakie podstawowe operacje można wykonywać na datach i czasie,
- jak podsumowywać / opisywać daty.

Do ilustracji tych zagadnień wykorzystamy zbiory danych tworzone ad hoc.

---

# Daty i czas

W programie R istnieją trzy podstawowe typy zmiennych opisujące daty lub czas.

+ Klasa `Date` służy do opisywania dat z dokładnością do dnia. Na datach można wykonywać operacje takie jak odejmowanie dwóch dat, dodawanie liczby do dnia itp.

+ Klasa POSIXct, służy do opisywania czasu z dokładnością do sekundy. Czas jest pamiętany jako liczba sekund od określonego początku. Sufiks `ct` oznacza *calendar time*.

+ Klasa POSIXlt, służy do opisywania czasu w formacie listy wartości. Sufiks `lt` oznacza *local time*. 

---

# Daty

Konstruktorem klasy `Date` jest funkcja `as.Date()`.

Jako pierwszy argument przyjmuje wektor napisów opisujących daty. Drugi opcjonalny argument określa formatowanie daty. Domyślne formatowanie to rok-miesiąc-dzień. 

```{r}
as.Date("2015-02-22")
as.Date("02/22/2015", format = "%m/%d/%Y")
as.Date("February 2, 2015", format = "%B %d, %Y") # działa dla angielskojęzycznej wersji R
```

Aby uzyskać dokładną pomoc dotyczącą oznaczeń w formatowaniu daty należy otworzyć plik pomocy instrukcją `?strptime`.

Obiekty klasy `Date` można tworzyć także na podstawie liczb całkowitych lub obiektów klasy POSIXct, w obu przypadkach przy pomocy funkcji `as.Date()`.

---

# Czas calendar time

Konstruktorem klasy `POSIXct` jest funkcja `as.POSIXct()`.

Jako pierwszy argument przyjmuje wektor napisów opisujących chwile czasu. Drugi opcjonalny argument określa formatowanie daty. Domyślne formatowanie to rok-miesiąc-dzień godzina:minuta:sekunda. 

Aby uzyskać dokładną pomoc dotyczącą oznaczeń w formatowaniu daty należy otworzyć plik pomocy instrukcją `?strptime`.

```{r}
(czas1 <- as.POSIXct("2015-02-13 12:56:26"))
(czas2 <- as.POSIXct("14022015 12:56:26", format = "%d%m%Y %H:%M:%S"))
```

Na czasach można wykonywać takie operacje jak odejmowanie czy dodawane do określonego przedziału czasu (dodanie liczby całkowitej, domyślnie dodaje określoną liczbę sekund).

```{r}
# różnica czasów
czas2 - czas1
czas1
czas1 + 30
```

Funkcja `Sys.time()` jako wynik zwraca aktualny czas w formacie `POSIXct`.

```{r}
Sys.time()
Sys.time() - czas1
```

---

# Czas local time

Konstruktorem klasy `POSIXlt` jest funkcja `as.POSIXlt()`.

Jako pierwszy argument przyjmuje wektor napisów opisujących chwile czasu. Drugi opcjonalny argument określa formatowanie daty. 
Opis formatowania stosuje się taki sam, jak w przypadku klasy `POSIXct`.

```{r}
(czas1 <- as.POSIXlt("2015-02-13 12:56:26"))
(czas2 <- as.POSIXlt("14022015 12:56:26", format = "%d%m%Y %H:%M:%S"))
```

Obiekty klasy `POSIXlt` to listy, można się do ich elementów odwoływać przez nazwę.

```{r}
czas1$sec
czas1$min
czas1$zone
```


Wiele funkcji można stosować zamiennie do obiektów klasy `POSIXlt` i `POSIXct`

```{r}
# różnica czasów
czas2 - czas1
czas1 + 30
```

---

# Pakiet lubridate

W podstawowym programie R operacje na datach i czasie nie zawsze są proste. Tzn. proste operacje są proste, ale złożone już niekoniecznie.

Pakiet `lubridate` zawiera zestaw funkcji ułatwiający pracę z datami.

Jedną z takich funkcji jest `now()`, która zwraca obiekt opisujący bieżącą chwilę.

```{r}
library(lubridate)
now()
today()
```

Uproszczono nazwy funkcji, służące do konwertowania napisów na czas. Nazwa funkcji staje się opisem formatu.

```{r}
ymd_hms("2015-02-14 23:59:59")
(czas3 <- mdy_hm("02/14/15 08:32"))
```

---

# Pakiet lubridate

Z dat można wyłuskiwać takie informacje jak dzień tygodnia, dzień miesiąca itd.
Funkcją `wday()` można odczytać dzień tygodnia, podobnie funkcje `day()`, `month()` i `year()` opisują składowe daty.

```{r}
wday(czas3, label = TRUE)
```
Tydzień w roku, dzień miesiąca, miesiąc i rok.
```{r}
week(czas1)
day(czas1)
month(czas1)
year(czas1)
```

Na czasach można wykonywać wygodne operacje używając funkcji `days()`, `months()`, `years()`, `minutes()`, `seconds()`.

```{r}
czas3 + hours(4)
czas3 + days(2) + months(4) + years(1)
```

---

# Zadania

+ Używając odpowiedniego formatowania zamień napis `01-15-2015 10:20:59` na obiekt klasy `POSIXct`.

+ Oblicz liczbę dni pomiędzy 1 września 1945 roku a 8 maja 1945.

+ Sprawdź jaki dzień tygodnia będzie za 100 dni od dziś


---

# Więcej informacji

Przydatne wskazówki jak pracować z czasem i datami znaleźć można w artykule  *Handling date-times in R* Cole Beck
http://biostat.mc.vanderbilt.edu/wiki/pub/Main/ColeBeck/datestimes.pdf.

Szczegółowy opis pakietu `lubridate` znajduje się w artykule z JSS http://www.jstatsoft.org/v40/i03/paper

Wiele interesujących informacji o pracy z czasem i datami znajduje się tutaj:
http://en.wikibooks.org/wiki/R_Programming/Times_and_Dates

