---
title: "Wybór zmiennych z danych [dplyr / select]"
author: "pogRomcy danych"
date: "sezon 1 / odcinek 20 <br><br> Wszelkie prawa zastrzeżone.<br> Wykorzystanie możliwe wyłącznie za zgodą autora.  <br><br><br><br>Naciśnij `A` by zamienić slajdy na ciągły tekst. <br> Naciśnij `T` by wyświetlić spis treści."
output:
  slidy_presentation:
    includes:
      in_header: ../tracking.html
    highlight: default
    css: ../style.css
    font_adjustment: 0
    footer: "pogRomcy danych / przetwarzanie / wybór kolumn "

---

# O czym jest ten odcinek

Pracując na danych o ofertach sprzedaży aut można było odczuć jak niewygodna jest praca na danych które mają wiele kolumn,
w sytuacji gdy potrzebujemy jedynie kilku z nich. W odcinku 7 pokazaliśmy jak wybierać kolumny spełniające określone kryterium, używając operatora `[`. 

W codziennej pracy aby wybrać kolumny z całego zbioru danych nie tylko wygodniej, ale i szybciej jest wykorzystać dedykowaną funkcję `select()` z pakietu `dplyr`.

W tym odcinku nauczymy się:

- jak ze zbioru danych wybierać tylko interesujące nas kolumny,
- jak ze zbioru danych wybierać kolumny wszystkie poza wskazanych.

Do ilustracji tych zagadnień wykorzystamy dwa zbiory danych. Pierwszy, mały zbiór danych, to `koty_ptaki` a drugi, 
znacznie większy, to `auta2012`, oba dostępne w pakiecie `PogromcyDanych`.

---

# Wybór zmiennych przez wskazanie

Zbiór `koty_ptaki` na niewiele kolumn, można je wszystkie wyświetlić na konsoli. 
Czasem jednak nadmiarowe zmienne jedynie utrudniają skupienie się na tym co ważne. 

Aby zmienić kolejność kolumn lub wybrać jedynie podzbiór interesujących kolumn wykorzystać możemy funkcję `select()`.

W przykładzie poniżej wyświetlimy nazwy kolumn w zbiorze danych `koty_ptaki`. A następnie wybierzemy trzy z tych kolumn w kolejności
`gatunek, predkosc, waga`.

```{r, warning=FALSE, message=FALSE}
library(PogromcyDanych)
library(dplyr)
colnames(koty_ptaki)

koty_ptaki %>%
  select(gatunek, predkosc, waga)
```


---

# Wybór zmiennych używając operatora : lub -

Jeżeli kolumn w zbiorze danych jest wiele to wymienienie ich nazw jedna po drugiej może być niewygodne. 
W tym przypadku warto wykorzystać operator `:`, który pozwala na wybór kolumn od wskazanej do wskazanej.

```{r, warning=FALSE, message=FALSE}
koty_ptaki %>%
  select(gatunek:dlugosc, druzyna) %>% 
  head()
```

W funkcji `select()` można wykorzystać operator `-` aby wybrać z ramki danych wszystkie kolumny poza wskazanymi.

```{r, warning=FALSE, message=FALSE}
koty_ptaki %>%
  select(-habitat, -waga, -druzyna) %>% 
  head()
```

---

# Auta

Operacje filtrowania przećwiczymy też na znacznie większym zbiorze danych, który już nie sposób w całości wyświetlić na ekranie. Mianowicie na zbiorze danych o cenach ofertowych używanych samochodów.

Zbiór danych `auta2012` jest dostępny po wczytaniu pakietu `PogromcyDanych`. Poniżej przedstawiamy listę nazw kolumn z tego zbioru danych, więcej informacji o tym zbiorze danych znaleźć można na stronie https://rawgithub.com/pbiecek/MOOC/master/0_dane/0_dane.html

W tym zbiorze dostępne są następujące dane.

```{r, message=FALSE}
colnames(auta2012)
```

Funkcja `select()` pozwala w prosty sposób wybrać kilka potrzebnych zmiennych z dużego zbioru danych. Pierwszym argumentem jest ramka danych, a kolejne to zmienne, które chcemy pozostawić. 


---

# Wybór zmiennych przez wskazanie

Przypuśćmy, że chcemy wybrać tylko Cenę, Markę, Model, Wersję i Przebieg.w.km. Wystarczy te zmienne wymienić jako argumenty funkcji `select()`.

```{r, warning=FALSE}
auta2012 %>%
    select(Cena.w.PLN, Marka, Model, Wersja, Przebieg.w.km) %>%
    head()
```

---

# Wybór zmiennych przez usunięcie

Jeżeli chcemy usunąć kilka kolumn, można do tego wykorzystać operator `-`. 

Na poniższym przykładzie usuwamy 9 wskazanych kolumn.

```{r, warning=FALSE}
auta2012 %>%
  select(-Cena, -Waluta, -Brutto.netto, -Rodzaj.paliwa,
         -Kraj.aktualnej.rejestracji, -Kraj.pochodzenia,
         -Pojazd.uszkodzony, -Skrzynia.biegow,
         -Status.pojazdu.sprowadzonego, -Wyposazenie.dodatkowe) %>%
  head()
```

---

# Wybór zmiennych przez wzorzec

Wybierając kolumny, można również wskazywać te, których nazwy pasują do zadanego wzorca.

Przykład poniżej wykorzystujemy funkcję `matches()` aby wybrać wszystkie nazwy kolumn, które w nazwie mają wzorzec `aj`.

```{r, warning=FALSE}
auta2012 %>%
  select(matches("aj")) %>%
  head()
```

---

# Zadania

* Wybierz tylko samochody marki Volvo, posortuj je po pojemności skokowej, a następnie wyświetl tylko trzy kolumny: Markę, Cenę.w.PLN i Kolor.

* Wybierz tylko te kolumny, których nazwa kończy się na `a`.

Przykładowe odpowiedzi znajdują się na stronie https://rawgit.com/pbiecek/MOOC/master/0_dane/9_zadania.html

