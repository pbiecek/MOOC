---
title: "Cechy ilościowe"
author: "pogRomcy danych"
date: "sezon 1 / odcinek 5 <br><br><br><br>Naciśnij `A` by zamienić slajdy na ciągły tekst. <br> Naciśnij `T` by wyświetlić spis treści."
output:
  slidy_presentation:
    includes:
      in_header: ../tracking.html
    highlight: default
    css: ../style.css
    font_adjustment: 0
    footer: "pogRomcy danych / przetwarzanie / zmienne ilosciowe"

---

# O czym jest ten odcinek

W tym odcinku nauczymy się

- Jak ze zbioru danych wybierać tylko interesujące nas wiersze

Do ilustracji wykorzystamy dwa zbiory danych. Pierwszy, mały zbiór danych to `koty_ptaki` a drugi, znacznie większy to `auta2012`.

---

Czas na poznanie rodzajów danych, na jakie możemy się natknąć.

W trakcie tych zajęć przedstawimy cztery podstawowe typy danych, dane ilościowe, jakościowe, napisy i wartości logiczne.
Słowo typ, ma w tym przypadku to samo znaczenie co słowo rodzaj, ale jest częściej stosowane w analizie danych, dlatego będziemy poniżej mówić o czterech podstawowych typach.

Ale zanim dojdziemy do typów, wczytajmy dane

# Wczytanie danych

Na poprzednich zajęciach poznaliśmy kilka sposobów na wczytanie danych do R. 
Wczytajmy dane w formacie tekstowym używając funkcji `read.table()`.
Następnie używając funkcji `head()` by wyświetlić pierwsze dwa wiersze.


```{r, warning=FALSE, message=FALSE}
library(SmarterPoland)
head(auta2012, 2)
```

Każdy wiersz tego zbioru danych opisuje jedną ofertę sprzedaży auta. Każda kolumna opisuje jedną cechę / właściwość tej oferty.

---

# Cechy ilościowe
Przyjrzyjmy się takim cechom jak _Cena.w.PLN_ lub _Przebieg.w.km_. Cechy te są opisane przez liczby oraz przedstawiają ilości. 
Pierwsza z nich przedstawia _ilość_ pieniędzy, za którą sprzedawca chce sprzedać samochód, druga opisuje _ilość_ kilometrów, którą przejechał wystawiony na aukcji samochód. 

## Statystyki opisowe

Na zmiennych ilościowych wykonać możemy kilka operacji. 
Używając funkcji `mean()` możemy policzyć średnią cenę wystawionych aut.

```{r, warning=FALSE}
mean(auta2012$Cena.w.PLN)
```

Używając funkcji `min()` i `max()` możemy wyznaczyć minimalną i maksymalną cenę w tym zbiorze danych.

```{r, warning=FALSE}
min(auta2012$Cena.w.PLN)
max(auta2012$Cena.w.PLN)
```

[TODO] może warto dodac funkcje: range(auta2012$Cena.w.PLN) - wartosci ekstremalne
---

Używając funkcji `summary()` możemy wyznaczyć sześć podstawowych charakterystyk, czyli: minimum, 1. kwartyl, medianę (2. kwartyl), średnią, 3. kwartyl i maksimum.

*Kwartyle dzielą wektor **PCH: nie strasz ludzi - nie mówiłeś wcześniej nic o wektorach ;)** na cztery równoliczne części.*

+ Jedna czwarta samochodów ma cenę niższą od 1. kwartyla.
+ Jedna czwarta samochodów ma cenę wyższą od 1. kwartyla ale niższą od mediany (2. kwartyla).
+ Jedna czwarta samochodów ma cenę wyższą od mediany (2. kwartyla) ale niższą od 2. kwartyla.
+ Jedna czwarta samochodów ma cenę wyższą od 3. kwartyla.

```{r, warning=FALSE}
summary(auta2012$Cena.w.PLN)
```
[TODO] pod wynikiem funkcji summary dodac interpretacje otrzymanych kwartyli:
Q1 = 25% samoch ma cene nizsza niz 10900,
Q2 = 50% samoch ....

---

# Zadania:
+ W zbiorze danych _auta2012_ aż 7 cech to cechy ilościowe. Wymień które.
+ Jedną z cech ilościowych jest _Rok.produkcji_. Jaki jest medianowy/połówkowy rok produkcji oferowanych aut? Wszystkie te oferty były złożone w roku 2012, jaki był medianowy/połówkowy wiek oferowanego auta?

# Odpowiedzi:
+ `Cena`, `Cena.w.PLN`, `KM`, `kW`, `Pojemnosc.skokowa`, `Przebieg.w.km`, `Rok.produkcji`
+ `r median(auta2012$Rok.produkcji, na.rm=TRUE)` rok

---

# Brakujące dane
Może się tak zdarzyć, że oferta sprzedaży nie zawiera wszystkich informacji o aucie. Np. brakuje informacji o przebiegu. 
Takie braki danych trzeba jakoś oznaczyć. Nie można w ich miejsce wstawić np. 0, ponieważ czymś innym jest przebieg równy 0 a czymś innym jest brak informacji o przebiegu.

Potrzebna jest więc jakaś specjalna wartość, która będzie oznaczała brakujące wartości. W programie R taką wartością jest `NA` (skrót od _non available_, czyli _niedostępne_).

Jak zauważyć, że w danych występują wartości niedostępne? 
Ich liczba będzie wymieniona w wyniku funkcji `summary()`. Dla zmiennej `Przebieg.w.km` brakujących wartości jest 20 711.

```{r, warning=FALSE}
summary(auta2012$Przebieg.w.km)
```

---

Jakie są konsekwencje występowania brakujących wartości?
Część statystyk nie można policzyć.
Przykładowo, średnia z 1 i 3 to 2.
Ale ile wynosi średnia z 1 i _nie wiadomo_? 

Dlatego gdy liczmy średnie lub inne statystyki z takich wektorów to wynik jest wartością `NA`.

```{r, warning=FALSE}
mean(auta2012$Przebieg.w.km)
min(auta2012$Przebieg.w.km)
max(auta2012$Przebieg.w.km)
```

To logiczne. Jeżeli nie wszystkie wartości są znane, to nie można policzyć ani średniej ani minimum ani maksimum.

---

Logiczne ale też mało praktyczne. 
Często chcielibyśmy policzyć średnią, medianę, minimum tylko z tych wartości które są znane.

Aby to zrobić w programie R, do funkcji należy dodać argument `na.rm=TRUE`, gdzie `na.rm` to skrót od _remove NA_, czyli usuń wartości brakujące.

```{r, warning=FALSE}
mean(auta2012$Przebieg.w.km, na.rm=TRUE)
min(auta2012$Przebieg.w.km, na.rm=TRUE)
max(auta2012$Przebieg.w.km, na.rm=TRUE)
```

---

# Zadania:
+ Która cecha jest najmniej kompletna? Dla której cechy liczba brakujących wartości jest największa?
+ Jaka jest mediana/połówkowa wielkość silnika (`Pojemnosc.skokowa`)?

# Odpowiedzi:
+ Dla zmiennej `Przebieg.w.km`  jest `r sum(is.na(auta2012$Przebieg.w.km))` 20 711 brakujących wartości. Ta zmienna jest najmniej kompletna.
+  `r median(auta2012$KM, na.rm=TRUE)` cm3

**PCH: ponawiam swoją uwagę na temat zbioru danych, na którym bazują te materiały. Moim zdaniem
u Ciebe również nie zostały wczytane wszystkie wiersze z CSV'a - spróbuj sobie zrobić na 
podstawie danych z RDA.**

---

# Graficzne statystyki opisowe
Powyżej opisane statystyki liczbowe można przedstawić graficznie.
Prezentacja graficzna ma tę zaletę, że wyćwiczone oko potrafi szybko wiele dowiedzieć się z danych. 

Opisując zmienną ilościową mamy do wyboru różne sposoby prezentacji, w zależności od tego ile informacji chcemy przedstawić.

Przypuśćmy, że chcemy pokazać wyłącznie średnią. Jedną liczbę. Zrobimy to za pomocą wykresu słupkowego.
Wykres słupkowy można w programie R wyznaczyć funkcją `barplot()`.

```{r, warning=FALSE}
(srednia = mean(auta2012$Przebieg.w.km, na.rm=TRUE))
barplot(srednia)
```

Jeden słupek wygląda dziwnie, mało czytelnie. To dlatego, że wykres przedstawia jedną liczbę, trudno więc do czegoś się na nim odnieść.

Ciekawszy będzie wykres, przedstawiający więcej informacji. 
Powyżej pokazaliśmy wynik funkcji `summary()`, prezentujących sześć charakterystycznych informacji o rozkładzie (min, max, kwartyle i średnią).
Pięć z nich, za wyjątkiem średniej, przedstawia wykres pudełko-wąsy, który w R można wykonać używając funkcji `boxplot()`.

W poniższym przykładzie przedstawiamy te pięć liczb dla zmiennej `Przebieg.w.km`. Argument `horizontal=TRUE` powoduje, że wykres rysowany jest poziomo, argument `range = 0` powoduje, że nie są wyznaczane wartości odstające (a nie mówiliśmy co to za wartości, więc ich nie wyznaczajmy, wrócimy do tego tematu później).

```{r, warning=FALSE}
summary(auta2012$Przebieg.w.km)
boxplot(auta2012$Przebieg.w.km, 
        horizontal=TRUE, range = 0)
```

---

Co za dziwny wykres. Zazwyczaj wykresy pudełkowe wyglądają inaczej.
Co jest nie tak z tym? Spójrzmy na oś na wykresie, rozciąga się do 10^9 = 1 000 000 000 km. Najprawdopodobniej te duże wartości to wynik błędu w danych. Mała jest szansa, że jakiekolwiek auto na świecie miało choćby zbliżony przebieg (gdyby jakieś auto jeździło non stop z prędkością 100 km na godzinę, to po 100 latach miałoby przebieg 8 000 000 km).

Dane bardzo często są zanieczyszczone a graficzne prezentacje pozwalają nam to łatwo zauważyć. 
Tak jest i w tym przypadku.
Oczyśćmy te dane, usuwając wszystkie wiersze, dla których cecha `Przebieg.w.km` przyjmuje wartości powyżej 1 000 000 km.
Takie czyszczenie możemy przeprowadzić używając funkcji `filter()` z pakietu `dplyr`.

```{r, warning=FALSE}
library(dplyr)
auta2012wybrane <- auta2012 %>% 
  filter(Przebieg.w.km < 1000000)

summary(auta2012wybrane$Przebieg.w.km)
```

Teraz możemy narysować wykres pudełko-wąsy dla oczyszczonych danych.

```{r, warning=FALSE}
boxplot(auta2012wybrane$Przebieg.w.km, horizontal=TRUE, range=0)
```

---

Każdy z elementów tego wykresu (lewy wąs, lewa część pudełka, prawa część pudełka, prawy wąs) przedstawia 1/4 danych.
Z wykresu tego możemy łatwo odczytać, że 3/4 danych dotyczy aut o przebiegu poniżej 200 tys km. Jedynie 1/4 danych ma wyższe wartości i dla tych aut rozpiętość jest bardzo duża.

Jeżeli chcemy zaprezentować bardziej szczegółowe dane o przebiegu, możemy wykorzystać histogram.
Słowo histogram pochodzi z języka greckiego, pochodzi ze złożenia słów histos i gramma.**
Pierwsze oznacza rzeczy stojące pionowo, drugie oznacza zapis. W sumie chodzi o przedstawienie danych z użyciem pionowych słupków. **PCH: Ekstremalnie ważna informacja. Zabrakło wcześniej informacji co znaczy barplot i kilka innych nazw ;)

Aby wykonać w programie R histogram, można wykorzystać funkcję `hist()`. Pierwszy argument określa dane, które mają być pokazane,
drugi argument określa na ile przedziałów ma być podzielony zakres zmienności. 
Histogram przedstawia liczbę samochodów, których przebieg jest w zakresie opisanym przez określone pudełko.

```{r, warning=FALSE}
hist(auta2012wybrane$Przebieg.w.km, 60, col="grey")
```

---

Histogram przedstawia znacznie więcej informacji niż wykres pudełko-wąsy. Im wyższy słupek, tym więcej było aut, o przebiegu w określonym przedziale.
Dwie najwyższe wyspy to ta w pobliżu 0 oraz ta w pobliży 180 tys km. 
Oznacza to, że w zbiorze danych jest jedna duża grupa aut o bardzo małym przebiegu, aut o przebiegu w okolicy 50 tys km jest mniej, aut o przebiegu w okolicy 150 tys km jest bardzo dużo a aut o przebiegu ponad 300 tys km jest już bardzo mało, pojedyncze sztuki.

Jak widzimy zmienną ilościowa możemy opisać z różnym poziomem szczegółowości. Im większa szczegółowość tym więcej elementów na wykresie. 
Im więcej elementów tym więcej możemy odczytać ale jest to też trudniejsze.

---

# Zadania:
+ Przedstaw graficznie za pomocą wykresu pudełko-wąsy oraz histogramu rozkład cechy `Cena.w.PLN`. 
+ Zwróć uwagę, że pojedyncze auta o bardzo wysokich cenach, powodują że wykres jest mało czytelny. Oczyść te dane, pozostawiają tylko auta o cenie poniżej 100 tys pln. Następnie przedstaw rozkład cen aut w segmencie aut do 100 tys pln.
+ Aut w jakiej cenie jest najwięcej wśród zebranych ogłoszeń?

# Odpowiedzi:
```{r, warning=FALSE}
library(dplyr)
auta2012wybrane <- auta2012 %>% 
  filter(Cena.w.PLN < 100000)

boxplot(auta2012wybrane$Cena.w.PLN, horizontal = TRUE, range = 0)
hist(auta2012wybrane$Cena.w.PLN, 50, col="grey")
```


