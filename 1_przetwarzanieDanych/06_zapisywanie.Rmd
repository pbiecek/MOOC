---
title: "Jak zapisać dane z programu R"
author: "pogRomcy danych"
date: "sezon 1 / odcinek 6<br><br> Wszelkie prawa zastrzeżone.<br> Wykorzystanie możliwe wyłącznie za zgodą autora.  <br><br><br><br>Naciśnij `A` by zamienić slajdy na ciągły tekst. <br> Naciśnij `T` by wyświetlić spis treści."
output:
  slidy_presentation:
    includes:
      in_header: ../tracking.html
    highlight: default
    css: ../style.css
    font_adjustment: 0
    footer: "pogRomcy danych / eksploracja danych / zapisywanie danych z R"
---

# O czym jest ten odcinek

Program R jest świetnym narzędziem do przetwarzania danych. Mając już dane przetworzone pojawia się potrzeba by wyniki gdzieś zapisać.

Podobnie jak wczytywaliśmy dane z formatów - tekstowych, binarnych lub plików Excela - możemy również zapisywać dane do różnych formatów.

W tym odcinku dowiemy się:

- jak zapisać dane tabelaryczne do plików tekstowych,
- jak zapisać dane tabelaryczne do plików Excela (.xls lub .xlsx),
- jak zapisać dane w formacie binarnym programu R,
- gdzie szukać informacji o tym jak zapisać dane do innych formatów.

---

# Zapisywanie danych do pliku csv

Zacznijmy od przykładu, w którym stworzymy sztuczny zbiór danych o trzech wierszach i dwóch kolumnach, nazwiemy go `dwie_kolumny` a następnie zapiszmy do pliku tekstowego o rozszerzeniu `csv`.

Pliki `csv` są plikami tekstowymi, ale również są poprawnie odczytywane przez program Excel, przez co jest to popularne medium wymiany danych tabelarycznych. 

Aby zapisać dane do pliku możemy użyć funkcję `write.table()`. Poniższe instrukcje tworzą nowe dane oraz zapisują je do pliku `wazne_dane.csv` (w aktualnym katalogu) stosując jako separator kolumn średnik, a jako separator dziesiętny znak `.` (kropka). To, jaki katalog jest aktualnym katalogiem roboczym, można sprawdzić funkcją `getwd()`.

```{r, eval=FALSE}
# tworzymy nowy zbiór danych
dwie_kolumny <- data.frame(litery  = c("A", "B", "C"),
                           liczby  = c(1,2,3))
dwie_kolumny
#   litery liczby
# 1      A      1
# 2      B      2
# 3      C      3

write.table(dwie_kolumny, file="wazne_dane.csv", 
            sep = ";", dec = ".")

# w którym katalogu się zapisało?
getwd()
# /Users/pbiecek/Documents

# Równoważnie
write.table(dwie_kolumny, file="/Users/pbiecek/Documents/wazne_dane.csv", 
            sep = ";", dec = ".")

```

---

# Zapisywanie danych tabelarycznych do plików tekstowych

Dane, które są dostępne w programie R, można zapisać do pliku tekstowego funkcją `write.table()`. Można też funkcjami `write.csv()` lub `write.csv2()`, ale różnią się one wyłącznie domyślnymi wartościami parametrów.

Formatowanie (co jest separatorem kolumn, co jest separatorem dziesiętnym, itp.) określa się w ten sam sposób co w funkcji `read.table()`.

Formalna deklaracja funkcji `write.table()` jest następująca (pamiętajmy, że większość parametrów jest domyślna i zazwyczaj wystarczy zmienić tylko kilka).

```{r, eval=FALSE}
write.table(x, file = "", append = FALSE, quote = TRUE, sep = " ",
            eol = "\n", na = "NA", dec = ".", row.names = TRUE,
            col.names = TRUE, qmethod = c("escape", "double"),
            fileEncoding = "")
```

Najczęściej wykorzystywane argumenty to:

- `x` - określa jaka tabela/które dane mają być zapisane do pliku tekstowego,
- `file` - określa nazwę pliku tekstowego, do którego dane będą zapisane,
- `append` - domyślna wartość `FALSE` oznacza, że jeśli plik o nazwie `file` istnieje wcześniej, to zostanie on skasowany. Jeżeli ustawimy `append=TRUE` to nowe dane będą dopisane do końca poprzedniego pliku.
- `sep` - określa znak, który jest separatorem kolejnych wartości,
- `dec` - określa znak, który jest separatorem dziesiętnym (zazwyczaj `.` lub `,`),
- `row.names` - określa czy do pliku tekstowego mają być zapisywane nazwy wierszy, domyślnie `TRUE`,
- `col.names`  - określa czy do pliku tekstowego mają być zapisywane nazwy kolumn, domyślnie `TRUE`.

---

# Zapisywanie danych tabelarycznych do plików w formacie Excela

Dane, które są dostępne w programie R, można zapisać też do pliku Excela funkcją `write.xls()`. 

Funkcja ta jest dostępna w większości pakietów, zawierających funkcję `read.xls()`, np. w pakiecie `xlsx` (korzysta z biblioteki Java) oraz `dataframe2xls` (korzysta z zewnętrznych bibliotek języka Python).

Do zapisu do formatu Excela można też wykorzystać funkcję `WriteXLS()` z pakietu `WriteXLS` (korzysta z zewnętrznych bibliotek języka Perl).

Podstawowa funkcjonalność tych funkcji jest taka sama, pozwalają one na stworzenie nowego pliku oraz zapisania do niego tabeli.

Pakiety te różnią się dodatkowymi możliwościami. Niektóre potrafią zapisywać do plików Excelowych, które mają wiele zakładek. Inne potrafią zapisywać do pliku Excela z dodanym formatowaniem, takim jak określone kolory, wielkość pisma, krój czcionki, obrysowania tabeli.

Osobiście najczęściej korzystam z pakietu `xlsx`, ponieważ pozwala on na zapis danych do wielu zakładek z zadanym formatowaniem. 

```{r, eval=FALSE}
library(xlsx)
write.xslx(dwie_kolumny, file="/Users/pbiecek/Documents/wazne_dane.csv", 
            sheetName="Zakladka Wazne Dane")
```

---

# Zapisywanie danych do plików binarnych

Do pliku w formacie natywnym R, dane można zapisać funkcją `save()`. Funkcja ta zapisuje jeden lub więcej obiektów o dowolnych strukturach - nie tylko danych tabelarycznych, ale również wektorów czy bardziej złożonych struktur. 

Wadą tego rozwiązania jest to, że format ten nie jest odczytywany przez inne pakiety statystyczne. 

Jeżeli jednak pracujemy głównie z programem R i chcemy w przyszłości te dane odczytywać tylko z programu R, to jest to najwygodniejsza opcja, produkująca najmniejsze pliki, które łatwo i szybko można ponownie wczytać poleceniem `load()`.

Przykład użycia funkcji `save()`.

```{r, eval=FALSE}
# do katalogu roboczego
save(dwie_kolumny, file="wazne_dane.rda")

# podając pełną nazwę ścieżki
save(dwie_kolumny, file="/Users/pbiecek/Documents/wazne_dane.rda")
```

[PCH: Powinieneś dodać, że wraz z danymi zapisywane są również nazwy obiektów. I wspomnieć wtedy o tym co napisałeś przy okazji wczytywania za pomocą load().]

---

# Podsumowanie instrukcji R

W tym odcinku omawialiśmy funkcje służące do zapisywania danych do różnych formatów: tekstowych, Excelowych, binarnych. Poniżej znajduje się zestawienie wszystkich wykorzystanych w tym odcinku instrukcji.

```{r, eval=FALSE}
# tworzymy nowy zbiór danych
dwie_kolumny <- data.frame(litery  = c("A", "B", "C"),
                           liczby  = c(1,2,3))
dwie_kolumny
#   litery liczby
# 1      A      1
# 2      B      2
# 3      C      3

# zapisujemy do pliku tekstowego w lokalnym katalogu
write.table(dwie_kolumny, file="wazne_dane.csv", 
            sep = ";", dec = ".")
# który katalog jest lokalny/roboczy
getwd()
# /Users/pbiecek/Documents

# Równoważnie możemy użyć ścieżki bezwzględnej
write.table(dwie_kolumny, file="/Users/pbiecek/Documents/wazne_dane.csv", 
            sep = ";", dec = ".")

# zapisujemy dane do formatu Excela
library(xlsx)
write.xslx(dwie_kolumny, file="/Users/pbiecek/Documents/wazne_dane.csv", 
            sheetName="Zakladka Wazne Dane")

# zapisujemy dane do formatu binarnego
# do katalogu roboczego
save(dwie_kolumny, file="wazne_dane.rda")

# podając pełną nazwę ścieżki
save(dwie_kolumny, file="/Users/pbiecek/Documents/wazne_dane.rda")
```

---

# Zadanie

- Zapisz zbiór danych `koty_ptaki` do pliku tekstowego, w którym dane są rozdzielane przecinkiem a separatorem dziesiętnym jest `.` (kropka).

- Zapisz zbiór danych `koty_ptaki` do formatu pliku Excela. Sprawdź czy dane poprawnie się zapisały.

- Zapisz zbiór danych `koty_ptaki` do pliku binarnego. Odczytaj go następnie funkcją `load()` i sprawdź czy dane poprawnie zostały zapisane.

Przykładowe odpowiedzi znajdują się na stronie https://rawgit.com/pbiecek/MOOC/master/0_dane/9_zadania.html

---

# Więcej informacji 

Gdzie szukać dalszych informacji o zapisie i odczycie danych w innych formatach? 

Do R można wczytać i z R można zapisać dane w formacie programu SAS, SPSS, Statistica, Stata i wielu innych

- Więcej informacji o tym jak wczytywać dane z innych formatów oraz baz danych znaleźć można w rozdziale 2.2 książki *,,Przewodnik po pakiecie R''*. Rozdział ten jest dostępny bezpłatnie pod adresem http://biecek.pl/R.

- Bardziej szczegółowe informacje o tym jak wczytywać i zapisywać dane z i do baz danych lub plików w egzotycznych formatach znaleźć można w dokumencie *,,R Data Import/Export''*
http://cran.r-project.org/doc/manuals/r-release/R-data.pdf
https://github.com/pbiecek/MOOC/blob/master/materialyZewnetrzne/R-data.pdf?raw=true

- O ile *,,R Data Import/Export``* jest opisem ,,teoretycznym'' to bardzo ciekawe zebranie przypadków użycia funkcji do wczytywania danych z różnych formatów jest zebrane w wiki-książce *,,R programming''* dostępnej pod adresem 
http://en.wikibooks.org/wiki/R_Programming/Importing_and_exporting_data

- Interesujące zestawienie narzędzi do odczytywania danych ze stron internetowych znaleźć można na stronach z materiałami dydaktycznymi Gastona Sancheza http://gastonsanchez.com/teaching/

*Dla entuzjastów Excela* 

- Funkcje R można również uruchamiać wewnątrz programu Excel, należy w tym celu zainstalować dodatek RExcel(http://www.statconn.com/products.html). Na tych filmach można zobaczyć jak pracuje się z tym dodatkiem i jak go zainstalować https://www.youtube.com/watch?v=rigtfeeqnNs, https://www.youtube.com/watch?v=YH94AH6PVss, https://www.youtube.com/watch?v=wqgO9rrmQVY.

