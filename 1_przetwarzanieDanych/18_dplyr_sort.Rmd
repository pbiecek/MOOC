---
title: "Sortowanie danych [dplyr / arrange]"
author: "pogRomcy danych"
date: "sezon 1 / odcinek 18 <br><br> Wszelkie prawa zastrzeżone.<br> Wykorzystanie możliwe wyłącznie za zgodą autora.  <br><br><br><br>Naciśnij `A` by zamienić slajdy na ciągły tekst. <br> Naciśnij `T` by wyświetlić spis treści."
output:
  slidy_presentation:
    includes:
      in_header: ../tracking.html
    highlight: default
    css: ../style.css
    font_adjustment: 0
    footer: "pogRomcy danych / przetwarzanie / sortowanie wierszy"

---

# O czym jest ten odcinek

W programie R wiersze można sortować na kilka sposobów, jeden z użyciem funkcji `order()` pokazaliśmy w odcinku 7.

W codziennej pracy z danymi nie tylko wygodniej, ale i szybciej jest wykorzystać dedykowaną funkcję `arrange()` z pakietu `dplyr`.

W tym odcinku nauczymy się:

- jak porządkować wiersze rosnąco / malejąco względem określonej kolumny,
- jak i po co sortować po więcej niż jednej kolumnie.

Do ilustracji tych zagadnień wykorzystamy dwa zbiory danych. Pierwszy, mały zbiór danych, to `koty_ptaki` a drugi, 
znacznie większy, to `auta2012`, oba dostępne w pakiecie `SmarterPoland`.

---

## Ptaki vs. koty

Przykłady dla sortowanie rozpoczniemy na niewielkim zbiorze danych o kotach i ptakach. Ten zbiór danych jest dostarczany razem z pakietem `SmarterPoland`. Jest on na tyle mały, że łatwo ogarnąć go wzrokiem i przekonać się w jaki sposób zadziałało sortowanie wierszy.

```{r, message=FALSE}
library(SmarterPoland)
koty_ptaki
```

---

# Sortowanie danych

O ile wektor wartości można posortować funkcją `sort()`, to do sortowania wierszy w ramce danych względem określonej kolumny wygodnie jest użyć funkcji `arrange()`.

Ta funkcja jako pierwszy argument przyjmuje ramkę danych, a jako kolejne argumenty przyjmuje zmienne, wzdłuż których dane są sortowane.

Przykładowo aby posortować wiersze w zbiorze `koty_ptaki` w kolejności rosnącej ze względu na prędkość  (kolumna `predkosc`) można użyć następującej komendy.

```{r, warning=FALSE, message=FALSE}
library(dplyr)
arrange(koty_ptaki, predkosc)
```

---

# Sortowanie danych

Aby posortować w kolejności malejącej można albo zmienną, po której ma nastąpić sortowanie opatrzeć funkcją `desc()`, albo - dla zmiennych liczbowych - dodać znak `-` przed zmienną.

Obie poniższe instrukcje mają taki sam efekt.

```{r, warning=FALSE}
arrange(koty_ptaki,   desc(predkosc))
arrange(koty_ptaki,   -predkosc)
```

---

# Sortowanie po dwóch zmiennych

Jeżeli dla zmiennej, wzdłuż której sortujemy, mogą wystąpić remisy, czyli te same wartości, wtedy kolejność wierszy jest nieokreślona. Wygodnie jest w takich sytuacjach wskazać drugorzędowe kryterium sortowania.

Przykładowo, aby posortować wiersze uwzględniając prędkość, ale zrobić to osobno dla kotów osobno dla ptaków, możemy wskazać drużynę jako główne kryterium sortowania, a prędkość jako kryterium drugorzędne.

Sortując po kolumnie `druzyna` wiele wierszy ma te same wartości i o ich końcowej kolejności decyduje zmienna `predkosc`.

```{r, warning=FALSE}
arrange(koty_ptaki, 
        druzyna, predkosc)
```

---

# Auta

Operacje sortowania przećwiczymy też na znacznie większym zbiorze danych, który już nie sposób w całości wyświetlić na ekranie. Mianowicie na zbiorze danych o cenach ofertowych używanych samochodów.

Zbiór danych `auta2012` jest dostępny po wczytaniu pakietu `SmarterPoland`. Poniżej przedstawiamy 6 pierwszych wierszy z tego zbioru danych. Szczegółowy opis tego zbioru znajduje się na stronie https://rawgithub.com/pbiecek/MOOC/master/0_dane/0_dane.html

Wybierzmy ze zbioru danych tylko samochody marki `Porsche` z silnikiem ponad 300 KM, posortujmy wiersze w tym zbiorze danych zaczynając od najtańszych.

```{r, warning=FALSE}
tylkoPorscheZDuzymSilnikiem <- filter(auta2012,
         Marka == "Porsche",
         KM > 300)

posortowanePorsche <-
  arrange(tylkoPorscheZDuzymSilnikiem, 
        Cena.w.PLN)
```

---

# Najtańsze i najdroższe Porsche

Aby zobaczyć jakie wiersza są pierwsze a jakie są ostatnie w tym zbiorze danych, możemy użyć funkcji `head()` i `tail()`. Domyślnie przedstawianych jest pierwszych lub ostatnich 6 wierszy.

```{r, warning=FALSE}
head(posortowanePorsche)

tail(posortowanePorsche)
```

---

# Model i cena

Jeżeli wskażemy więcej niż jedną zmienną do sortowania, to w pierwszym kroku sortowanie odbędzie się wzdłuż pierwszej zmiennej, a w przypadku remisu (takich samych wartości), w drugim kroku, wzdłuż drugiej zmiennej.

W poniższym przypadku w pierwszym kroku sortujemy wzdłuż zmiennej `Model` auta, a gdy samochody mają ten sam model to ich kolejność jest określona przez drugą zmienną, czyli w tym przypadku cenę.

Zmienna `Model` za wartości przyjmuje napisy, a w tym przypadku sortowanie wykonywane jest w kolejności alfabetycznej.

```{r, warning=FALSE}
head(
   arrange(tylkoPorscheZDuzymSilnikiem, 
        Model, Cena.w.PLN)
  ) 
```

---

# Sortowanie malejąco

Domyślnie wartości sortowane są rosnąco. Jeżeli chcemy zmienić kolejność sortowania i sortować malejąco, to należy daną zmienną opakować funkcją `desc()`, tak jak na poniższym przykładzie.

```{r, warning=FALSE}
head(
   arrange(tylkoPorscheZDuzymSilnikiem, 
        Model, desc(Cena.w.PLN))
  ) 
```

---

# Zadania

* Posortuj auta wzdłuż wielkości silnika (liczby koni mechanicznych, kolumna `KM`) lub pojemności skokowej (kolumna `Pojemnosc.skokowa`). Które marki mają największe silniki?
* Wybierz tylko auta marki 'Rolls-Royce' i posortuj je po cenie.

Przykładowe odpowiedzi znajdują się na stronie https://rawgit.com/pbiecek/MOOC/master/0_dane/9_zadania.html


